# Clickjacking

- Clickjacking (UI Redressing) tricks users into clicking hidden elements by overlaying transparent iframes over legitimate content.
- Clickjacking (UI Redressing) is an interface-based attack where a user is tricked into clicking on actionable content on a hidden website by clicking on some other decoy content in a different website.

**How it works (The Layers)**

- The attacker loads the target website (e.g., a bank) inside an `<iframe>`.
    
- They set the iframe's CSS opacity to `0` (making it invisible).
    
- They position this invisible iframe on top of a "Decoy" button (like "Claim Prize").
    
- When the user clicks the Decoy, they are actually clicking the hidden button on the target site.

**Why CSRF Tokens don't work here?** Since the user is _physically_ clicking the button on the real website (loaded inside the iframe), the browser sends the valid CSRF token along with the request. The server thinks it's a legitimate action.

#### Step 1: Attacker Creates Fake Page
```
Attacker's Fake Page:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚   ğŸ‰ YOU WON FREE iPHONE! ğŸ‰        â”‚
â”‚                                     â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â”‚   CLAIM NOW!    â”‚  â† Fake button (z-index: 1)
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 2: Attacker Adds Hidden Bank Website
```
Adding invisible iframe ON TOP:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚  Bank Website (in iframe)       â”‚ â”‚ â† INVISIBLE (opacity: 0)
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚   z-index: 2 (ON TOP)
â”‚ â”‚  â”‚ DELETE ACCOUNT  â”‚            â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â”‚   CLAIM NOW!    â”‚            â”‚  â† z-index: 1 (BEHIND)
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 3: User Gets Tricked
```
What USER SEES:              What ACTUALLY EXISTS:
                             
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ YOU WON iPHONE!     â”‚      â”‚ â”‚ INVISIBLE BANK  â”‚ â”‚
â”‚                     â”‚      â”‚ â”‚ [DELETE ACCOUNT]â”‚ â”‚ â† User clicks HERE
â”‚   [CLAIM NOW!]      â”‚  =   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        â†‘            â”‚      â”‚   [CLAIM NOW!]      â”‚
â”‚   User clicks       â”‚      â”‚        â†‘            â”‚
â”‚                     â”‚      â”‚   User SEES this    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User thinks: "I'm clicking CLAIM NOW"
Reality: User clicked "DELETE ACCOUNT"
```


## Types of Clickjacking
## 1. Classic Clickjacking
```
User clicks "Play Video" â†’ Actually clicks "Transfer Money"
```

#### 2. Likejacking
```
User clicks anywhere â†’ Actually "Likes" a Facebook page
```
#### 3. Cursorjacking
```
Displayed cursor position â‰  Actual cursor position
```

#### 4. Cookiejacking
```
User drags something â†’ Exposes cookies/session data
```

## Vulnerable Code Example
#### Vulnerable Website (No Protection)
```HTML
<!-- victim-site.com - No frame protection -->
<!DOCTYPE html>
<html>
<head>
    <title>Banking Portal</title>
</head>
<body>
    <h1>Account Settings</h1>
    <form action="/delete-account" method="POST">
        <button type="submit">Delete My Account</button>
    </form>
</body>
</html>
```

#### Attacker's Malicious Page
```HTML
<!DOCTYPE html>
<html>
<head>
    <title>Win iPhone 15!</title>
    <style>
        /* Invisible iframe overlay */
        iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 500px;
            height: 300px;
            opacity: 0.0001;  /* Nearly invisible */
            z-index: 2;       /* On top */
        }
        
        /* Decoy button positioned under iframe's real button */
        .decoy-button {
            position: absolute;
            top: 150px;
            left: 100px;
            z-index: 1;
            padding: 20px 40px;
            background: green;
            color: white;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <h1>ğŸ‰ Congratulations! You Won!</h1>
    
    <!-- Decoy button user sees -->
    <button class="decoy-button">Claim Prize!</button>
    
    <!-- Hidden iframe loading victim site -->
    <iframe src="https://victim-bank.com/account-settings"></iframe>
</body>
</html>
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLICKJACKING ATTACK                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Attackerâ”‚ â”€â”€â”€â”€ â”‚ Malicious Site  â”‚ â”€â”€â”€â”€ â”‚ Victim User  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                       â”‚
       â”‚  1. Create page   â”‚                       â”‚
       â”‚   with iframe     â”‚                       â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
       â”‚                   â”‚                       â”‚
       â”‚                   â”‚  2. User visits       â”‚
       â”‚                   â”‚     malicious site    â”‚
       â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                   â”‚                       â”‚
       â”‚                   â”‚  3. Iframe loads      â”‚
       â”‚                   â”‚     victim-bank.com   â”‚
       â”‚                   â”‚     (user logged in)  â”‚
       â”‚                   â”‚                       â”‚
       â”‚                   â”‚  4. User clicks       â”‚
       â”‚                   â”‚     "Claim Prize"     â”‚
       â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                   â”‚                       â”‚
       â”‚                   â”‚  5. Actually clicks   â”‚
       â”‚  6. Action        â”‚     hidden button     â”‚
       â”‚     executed!     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
```


## Prevention Methods

#### 1: X-Frame-Options Header

Tells browser "Don't allow my website in any iframe!
```
Options:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DENY         â†’ No one can put me in iframe
SAMEORIGIN   â†’ Only MY website can use iframe
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### 2: Content-Security-Policy (CSP)

Modern and better version of X-Frame-Options
```
Options:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
'none'              â†’ No one can iframe me
'self'              â†’ Only my website can iframe me
https://trusted.com â†’ Only this website can iframe me
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### 3: Frame Busting JavaScript

If website is in iframe, BREAK OUT!
```
How it works:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.top  = The main browser window
window.self = Current window

If they're DIFFERENT â†’ We're in an iframe!
Solution: Redirect the TOP window to our page
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

## Testing for Clickjacking
### Manual Testing

```HTML
<!-- Save as clickjack-test.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Clickjacking Test</title>
</head>
<body>
    <h1>Clickjacking Vulnerability Test</h1>
    <iframe src="https://target-website.com" 
            width="800" 
            height="600">
    </iframe>
    
    <p>If you see the website above, it's VULNERABLE!</p>
    <p>If blank/error, it's PROTECTED.</p>
</body>
</html>
```

### Using Burp Suite
```
1. Capture request to target site
2. Right-click â†’ Engagement Tools â†’ Find Clickjacking
3. Burp generates PoC HTML
4. Check if iframe loads
```

### Using CURL
```bash
# Check for security headers
curl -I https://target-website.com | grep -iE "(x-frame-options|content-security-policy)"

# Expected secure response:
# X-Frame-Options: DENY
# Content-Security-Policy: frame-ancestors 'none'
```

```bash
curl -I https://target-website.com
```

```
HTTP/1.1 200 OK
Date: Mon, 15 Jan 2025 10:30:00 GMT
Content-Type: text/html
X-Frame-Options: DENY                              â† âœ… Protected  
Content-Security-Policy: frame-ancestors 'none'    â† âœ… Protected
Server: Apache
```

==If X-Frame-option & CSP is not available in response means website is vulnerable.==
## Impact
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ACTION                    â”‚  IMPACT                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Click "Delete Account"    â”‚  Account takeover          â”‚
â”‚  Click "Transfer Money"    â”‚  Financial loss            â”‚
â”‚  Click "Change Email"      â”‚  Account hijacking         â”‚
â”‚  Click "Enable Webcam"     â”‚  Privacy violation         â”‚
â”‚  Click "Like/Follow"       â”‚  Reputation manipulation   â”‚
â”‚  Click "Download File"     â”‚  Malware installation      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## `<iframe>` (The Container)

iframe = "inline frame" = A window inside a window

 **example:**
```HTML
<!-- This is your website -->
<html>
<body>
    <h1>My Website</h1>
    
    <!-- This loads Google INSIDE your website -->
    <iframe src="https://google.com"></iframe>
    
</body>
</html>
```

```
Your Browser Window
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  My Website                            â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         Google              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     [Search Box]            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                             â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚         â†‘                        â”‚  â”‚
â”‚  â”‚    This is IFRAME                â”‚  â”‚
â”‚  â”‚    (Google inside your site)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
ex:-
```HTML
<iframe src="https://facebook.com/delete-account"></iframe>
```

<iframe src="https://facebook.com/delete-account"></iframe>


## `z-index` (The Layering / Stacking)

z-index = Layer Order = Which thing is on TOP


Computer screen par 3 directions hoti hain:

1. **X-axis:** Left - Right
    
2. **Y-axis:** Up - Down
    
3. **Z-axis:** **Aage - Peeche (Depth)**
    

**`z-index`** decide karta hai ki Z-axis par kaunsi cheez sabse upar (top) hogi.

Higher z-index = More on TOP
Lower z-index = More on BOTTOM

**Code Example:**
```HTML
<style>
    .bottom-layer {
        z-index: 1;    /* BEHIND */
    }
    
    .top-layer {
        z-index: 100;  /* IN FRONT */
    }
</style>
```

```
z-index: 1 (Back)        z-index: 2 (Front)

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Blue   â”‚              â”‚  Red    â”‚
    â”‚   Box   â”‚      â†’       â”‚ covers  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  Blue   â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Red has HIGHER z-index, so it's ON TOP of Blue
```

==**Decoy Button:** `z-index: 1` (Visible but at the bottom).==
==**Target Iframe:** `z-index: 2` (Invisible but on top).==

==**The Click:** Since the iframe is on top, any click by the user lands on the iframe, not the decoy button underneath.==
