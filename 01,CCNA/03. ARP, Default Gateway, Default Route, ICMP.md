
# Address Resolution Protocol(ARP)
- Maps an IP address to a MAC address on the same local network.
- ARP is the "bridge" between the Network Layer (Layer 3) and the Data Link Layer (Layer 2).

## Working
**example:**
PC1 (192.168.1.10) wants to send data to PC2 (192.168.1.20) on the same LAN.

#### 1: Check ARP Cache
PC1 checks its local ARP table to see if it already knows PC2’s MAC address
```bash
PC1> arp -a
# If not found → proceed to ARP Request
```

#### 2: Send ARP Request (Broadcast)
PC1 broadcasts an ARP Request frame to all devices on the LAN:

```
┌─────────────────────────────────────────────┐
│  Who has 192.168.1.20? Tell 192.168.1.10    │
│  Sender MAC: AA:AA:AA:AA:AA:AA              │
│  Sender IP: 192.168.1.10                    │
│  Target IP: 192.168.1.20                    │
│  Target MAC: 00:00:00:00:00:00 (unknown)    │
└─────────────────────────────────────────────┘
► Destination MAC: FF:FF:FF:FF:FF:FF (Broadcast)
```

#### 3: Target Device Replies (Unicast)
Only PC2 (with IP 192.168.1.20) responds with an ARP Reply:

```
┌─────────────────────────────────────────────┐
│  192.168.1.20 is at BB:BB:BB:BB:BB:BB      │
│  Sender MAC: BB:BB:BB:BB:BB:BB              │
│  Sender IP: 192.168.1.20                    │
│  Target MAC: AA:AA:AA:AA:AA:AA              │
│  Target IP: 192.168.1.10                    │
└─────────────────────────────────────────────┘
► Destination MAC: AA:AA:AA:AA:AA:AA (Unicast)
```

####  4: Update ARP Tables & Communicate
- PC1 adds PC2’s IP→MAC mapping to its ARP cache
- Now PC1 can send frames directly to PC2 using its MAC address
- Communication proceeds via unicast

==ARP table Reset after every 4 hours at Router== 

## Key Concepts
1. ARP is Local Only
ARP only works within the same broadcast domain (same VLAN/subnet). It cannot cross routers.
      ==To communicate with devices outside your subnet, you use the default gateway’s MAC, not the destination device’s MAC.==


# Default Gateway 
The default gateway is the IP address of the router that a device uses to send traffic when the destination IP is not on the local network (i.e., outside the local subnet).

```
┌──────────────────────────────────────────────────────┐
│  "If the destination isn't on my local network,      │
│   send it to the default gateway!"                   │
└──────────────────────────────────────────────────────┘
```

```
┌──────────────────────────────────────────────────────────────────┐
│                     LOCAL NETWORK                                │
│                    192.168.1.0/24                                │
│                                                                  │
│   ┌─────────┐       ┌─────────┐       ┌─────────┐               │
│   │   PC1   │       │   PC2   │       │  Printer│               │
│   │.1.10    │       │.1.20    │       │.1.30    │               │
│   └────┬────┘       └────┬────┘       └────┬────┘               │
│        │                 │                 │                    │
│        └─────────────────┼─────────────────┘                    │
│                          │                                      │
│                    ┌─────┴─────┐                                │
│                    │  Switch   │                                │
│                    └─────┬─────┘                                │
│                          │                                      │
│                    ┌─────┴─────┐                                │
│                    │  Router   │  ← DEFAULT GATEWAY             │
│                    │ 192.168.1.1│                               │
│                    └─────┬─────┘                                │
└──────────────────────────┼──────────────────────────────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  INTERNET   │
                    │  10.0.0.0/8 │
                    │ 172.16.0.0  │
                    └─────────────┘
```

- 192.168.1.50 → Same subnet → sends directly (uses ARP to find MAC)
- 8.8.8.8 (Google) → Different subnet → sends to default gateway (192.168.1.1)
## Working
1. Host wants to send packet to 172.16.10.5
2. Host checks destination IP against its own subnet
- My IP: 192.168.1.10/24
- Destination: 172.16.10.5 → Not in 192.168.1.0/24
    → This is a remote network

3. Host sends packet to default gateway (192.168.1.1)
4. Host uses ARP to find the MAC address of 192.168.1.1
5. Host builds Ethernet frame:
- Source MAC: PC1’s MAC
- Destination MAC: Router’s MAC
- Source IP: 192.168.1.10
- Destination IP: 172.16.10.5 (unchanged!)
1. Router receives packet, looks up its routing table, and forwards toward 172.16.10.5

### troubleshooting default gateway
```
Windows: ipconfig
Linux: ip route | grep default
```

# Default Route
- A default route is a special routing table entry that tells a router where to send packets when there is no specific route to the destination network.
- A default route prevents routers from needing to know every possible network on the internet.
```
┌──────────────────────────────────────────────────────┐
│  "If I don't know where this packet goes,            │
│   send it to the default route!"                     │
└──────────────────────────────────────────────────────┘
```

==Represented as: 0.0.0.0/0 or 0.0.0.0 0.0.0.0 (matches ALL destinations)==

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   PC (End Device)                    Router                    │
│   ┌──────────────┐                  ┌──────────────┐           │
│   │ Default      │                  │ Default      │           │
│   │ Gateway:     │────sends to─────►│ Route:       │           │
│   │ 192.168.1.1  │                  │ 0.0.0.0/0    │           │
│   └──────────────┘                  └──────────────┘           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### example of working
#### 1: Router Receives Packet
```
Router receives packet from PC1:
Source: 192.168.1.10
Destination: 8.8.8.8
```

####  2: Router Checks Routing Table
```
Router performs longest prefix match lookup:

Route Table:
C  192.168.1.0/24 → Directly connected      ❌ (8.8.8.8 doesn't match)
S* 0.0.0.0/0 → via 203.0.113.1              ✅ (Matches everything!)
```

#### 3: Router Forwards to Next-Hop
```
Router forwards packet to 203.0.113.1 (ISP)
ISP routes it toward 8.8.8.8
```

#### 4: Return Traffic
```
Reply from 8.8.8.8 comes back through ISP
Router receives it, checks routing table
Matches 192.168.1.0/24 (directly connected)
Delivers to PC1
```

# ICMP (Internet Control Message Protocol)

ICMP is a Layer 3 protocol (works directly over IP) whose only job is to report errors, diagnostics, and control information about IP packet processing.

It does NOT carry user data like HTTP, FTP, or SSH. It is purely a control/support protocol.

ICMP (Internet Control Message Protocol) is a network layer protocol used for:
- Reporting errors in IP packet processing
- Diagnostic functions (ping, traceroute)
- Network troubleshooting and management


TCP/IP
```
┌─────────────────────────────────┐
│      Application Layer          │
├─────────────────────────────────┤
│      Transport Layer            │
│        (TCP / UDP)              │
├─────────────────────────────────┤
│      Network Layer              │
│    ┌───────┬───────┬──────┐     │
│    │  IP   │ ICMP  │ ARP  │     │
│    └───────┴───────┴──────┘     │
├─────────────────────────────────┤
│   Data Link Layer (Ethernet)    │
├─────────────────────────────────┤
│      Physical Layer             │
└─────────────────────────────────┘
```

### Working
```
Your Computer                              Server
     │                                        │
     │   "Are you there?" (Echo Request)      │
     │───────────────────────────────────────>│
     │                                        │
     │   "Yes, I'm here!" (Echo Reply)        │
     │<───────────────────────────────────────│
```

### Message Format
```
┌──────────┬──────────┬────────────────┐
│   Type   │   Code   │    Checksum    │
│ (8 bits) │ (8 bits) │   (16 bits)    │
├──────────┴──────────┴────────────────┤
│              Data                    │
└──────────────────────────────────────┘
```


- Type = What kind of message
- Code = More details about the message
- Checksum = Error checking

### Two Category
```
ICMP Messages
      │
      ├── Error Messages (Something went wrong)
      │     • Destination Unreachable
      │     • Time Exceeded
      │
      └── Query Messages (Asking/Responding)
            • Ping Request
            • Ping Reply
```

**Example:**
```
┌─────────────────────────────────────────────────────────────────┐
│                     LOCAL AREA NETWORK                          │
│                                                                 │
│    PC-A (New Device)                         PC-B               │
│    ┌──────────────┐                    ┌──────────────┐         │
│    │ IP: 192.168.1.10                  │ IP: 192.168.1.20       │
│    │ MAC: AA:AA:AA:AA:AA:AA            │ MAC: BB:BB:BB:BB:BB:BB │
│    │ ARP Table: EMPTY                  │                        │
│    └───────┬──────┘                    └───────┬──────┘         │
│            │                                   │                │
│            └───────────┬───────────────────────┘                │
│                        │                                        │
│                 ┌──────┴──────┐                                 │
│                 │   SWITCH    │                                 │
│                 │ MAC Table:  │                                 │
│                 │   EMPTY     │                                 │
│                 └─────────────┘                                 │
└─────────────────────────────────────────────────────────────────┘
```

```
┌────────────────────────────────────────────────────────────────┐
│           FIRST TIME COMMUNICATION PROCESS                     │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  PHASE 1: ARP Process (Find MAC Address)                       │
│     Step 1: PC-A checks ARP cache → EMPTY                      │
│     Step 2: PC-A sends ARP Request (Broadcast)                 │
│     Step 3: Switch learns PC-A's MAC                           │
│     Step 4: PC-B receives ARP Request                          │
│     Step 5: PC-B sends ARP Reply (Unicast)                     │
│     Step 6: Switch learns PC-B's MAC                           │
│     Step 7: PC-A receives ARP Reply, updates ARP table         │
│                                                                │
│  PHASE 2: ICMP Process (Ping)                                  │
│     Step 8: PC-A sends ICMP Echo Request                       │
│     Step 9: PC-B receives request                              │
│     Step 10: PC-B sends ICMP Echo Reply                        │
│     Step 11: PC-A receives reply → PING successful!            │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```