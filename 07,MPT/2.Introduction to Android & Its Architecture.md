Android is an open-source, Linux-based mobile operating system developed by Google, primarily designed for touchscreen devices like smartphones and tablets.


### **1. What is Android?**

- **Android** is an open-source mobile operating system developed by **Google**.
    
- Based on the **Linux Kernel**.
    
- Designed mainly for **touchscreen mobile devices**.
    
- Supports a huge ecosystem of apps written primarily in **Java**, **Kotlin**, and partially **C/C++**.

#### Key Characteristics

- Open-source (AOSP – Android Open Source Project)
    
- Highly customizable by vendors (Samsung, Xiaomi, etc.)
    
- Secure by design (sandboxing, permission model)
    


| Attribute             | Details                                 |
| --------------------- | --------------------------------------- |
| Developer             | Google (originally Android Inc.)        |
| Initial Release       | September 23, 2008                      |
| Based On              | Linux Kernel                            |
| License               | Apache License 2.0 (mostly open source) |
| Programming Languages | Java, Kotlin, C, C++                    |
| Current Version       | Android 14 (2024)                       |
| Market Share          | ~70% of mobile devices worldwide        |

### Feature of Android                                                                                                                             
1.  open source

Android’s source code is freely available through the Android Open-Source Project (AOSP).

2. Linux-Based

Uses a modified Linux kernel for hardware control, memory management, and security.

3. Highly Customizable

Supports widgets, themes, custom ROMs, launchers, and OEM modifications.

4. Google Ecosystem

Comes integrated with:

- Gmail
- Google Maps
- YouTube
- Google Drive
- Google Play Store
- 5. Huge App Support

Millions of applications are available via Play Store and third-party stores.

6. Multi-Tasking

Can run multiple applications at the same time.

### History

- Created by Android Inc. in 2003 
- Acquired by Google in 2005 
- First Android phone (HTC Dream) launched in 2008 
- Early versions named after desserts (Cupcake, Oreo, Pie)
- Now versions use numbers (Android 10, 11, 12, 13, etc.)

### OEM:

OEM stands for Original Equipment Manufacturer. An OEM is a company that manufactures hardware or devices on which the Android OS runs.

### OHA:

OHA stands for Open Handset Alliance. It is a group of mobile companies, software developers, and hardware manufacturers formed by Google in 2007 to develop and promote Android.

## Types of Android Applications

### 1. Native Applications

These apps are developed specifically for Android using:

- Java 
- Kotlin 
- Android Studio 

Examples:

- WhatsApp
- YouTube
- Phone Dialer
- Camera app

Advantages: Fast, secure, best performance.

### 2. Web Applications

These are apps that run inside a web browser (Chrome, Firefox, etc.).

They are created using:

- HTML
- CSS
- JavaScript

Examples:

- Facebook web
- Twitter web
- Amazon mobile website

Advantages: No installation is required.

### 3. Hybrid Applications

These apps are a mix of web + native.

They use web technologies but are packaged as native apps using frameworks like:

- React Native
- Flutter
- Ionic
- PhoneGap

Examples:

- Instagram
- Uber
- Gmail app (partly hybrid)

Advantages: One app works on both Android and iOS.

### 4. System Applications

These apps come pre-installed in Android devices and are part of the system.

Examples:

- Settings
- Contacts
- Messages
- File Manager

Advantages: Essential for device operation.

### 5. Enterprise Applications

Apps developed for business or organizational use.

Examples:

- Office 365
- Slack
- Zoom
- CRM apps

Advantages: Improve productivity and security.

### 6. Gaming Applications

Apps focused on entertainment and gameplay.

Examples:

- PUBG
- Free Fire
- Candy Crush
- Ludo King

Advantages: High engagement, graphics heavy.

### 7. Utility Applications

Apps that perform daily tasks or system functions.

Examples:

- Alarm clock
- Calculator
- Flashlight
- File cleaner apps


![[Screenshot (45).png]]

## Android Architecture Overview

Although Android supports a range of hardware architectures, the majority of devices use the **==ARM (AArch64) architecture==**. Architectures such as x86 and x86-64 have also been supported, primarily in later Android versions that included Intel processors.


As we mentioned in the previous section, Android is a Linux-Based OS, and once someone gains access to a shell on the device, Linux commands can be executed.
![[Screenshot (45).png]]

### Architecture

![[Screenshot (46).png]]


### Layer 1: Linux Kernel (Bottom Layer)

Purpose: Foundation of Android OS

| ***Component***    | ***Function***                          |
| ------------------ | --------------------------------------- |
| Process Management | Handles running processes and threads   |
| Memory Management  | Allocates and manages RAM               |
| Security           | Provides user-based permissions model   |
| Device Drivers     | Interface between hardware and software |
| Binder IPC         | Inter-process communication mechanism   |
| Power Management   | Battery and power optimization          |
 Device drivers are here (Wi-Fi, Bluetooth, Camera, etc.)
 
 Security relevance: -
  - SELinux enforcement at kernel level 
  - Process isolation
  - Memory protection 
  - Privilege separation

|**Kernel-Level Security Features**|
|---|
|Prevent users from reading each other's files.|
|Prevent users from exhausting each other's memory.|
|Prevent users from exhausting CPU resources.|
|Prevent users from exhausting devices resources, like telephony, GPS, and Bluetooth.|

The Linux kernel is the foundation of the Android platform, and is responsible for managing device hardware such as the display, camera, bluetooth, wifi, audio, USB, and more. Android Runtime also relies on this layer to perform functionalities like threading and memory management.


### Layer 2: Hardware Abstraction Layer (HAL)

**Purpose: Standardized interface between hardware and higher-level Java API framework**

**Acting as a bridge between hardware and the higher-level software layers**

The Hardware Abstraction Layer (HAL) is a software layer that provides the Android operating system with a standardized interface for interacting with hardware components, such as cameras, Bluetooth, sensors, and input devices. Acting as a bridge between hardware and the higher-level software layers, HAL ensures consistency in how software accesses hardware features. Because different hardware components may have unique requirements and capabilities, writing portable software that works across devices can be challenging. HAL addresses this by isolating hardware-specific implementation details from the Android framework. It is implemented as a collection of shared libraries that are dynamically loaded by the Android framework at runtime. This architecture allows device manufacturers to implement custom support for their hardware while maintaining compatibility with the broader Android platform.


### Layer 3: Native Libraries & Android Runtime

The Native C/C++ Libraries component is a set of libraries written in the C and C++ programming languages, and are included in the Android operating system. Developers generally use these libraries to achieve high performance or write low-level code to interact directly with the hardware. Hardening techniques for increasing security can also be implemented using native C++ code.

Android components like ART and HAL are created using native code, and in order for these components to work, access to native libraries is needed. Applications can access these libraries through the Java Native Interface (JNI), while programmers can use the [Android NDK](https://developer.android.com/ndk) to access native libraries directly from their native code.
#### Native Libraries (C/C++)

| Library             | Purpose                                |
| ------------------- | -------------------------------------- |
| **libc (Bionic)**   | Custom C library optimized for Android |
| **libssl**          | SSL/TLS encryption                     |
| **SQLite**          | Lightweight database engine            |
| **WebKit**          | Web browser engine                     |
| **OpenGL ES**       | 3D graphics rendering                  |
| **Media Framework** | Audio/video codecs                     |
Apps can call them using the **NDK** (Native Development Kit).

#### Android Runtime (ART)
Android Runtime (ART) is the managed runtime environment used by the Android operating system to execute applications. Introduced in Android 5.0 Lollipop as a replacement for the Dalvik virtual machine, ART brought significant architectural improvements to app execution.

Replaced Dalvik VM in Android 5.0 (Lollipop)
Executes app code compiled into **DEX bytecode**.

ART is capable of running multiple virtual machines concurrently, even on low-memory devices, and it executes applications packaged in the DEX (Dalvik Executable) format. Importantly, ART maintains backward compatibility with applications originally built for Dalvik.

Key Features of ART:-

- AOT (Ahead-of-Time) Compilation
      └── Compiles apps during installation
- Improved Garbage Collection
      └── Reduced memory overhead
- Better Debugging Support
      └── Enhanced profiling and diagnostics
- DEX Bytecode Execution
      └── Runs .dex (Dalvik Executable) files


#### Dalvik vs ART

| DALVIK (Old)                  | ART (Current)<br>              |
| ----------------------------- | ------------------------------ |
| JIT(Just-in-Time) Compilation | AOT(Ahead-of-Time) Compilation |
| Compile at runtime <br>       | Compile at install<br>         |
| Slower app launch             | Faster app launch<br>          |
| Less storage needed           | More storage needed            |
| Lower install time            | Longer install time            |


### Layer 4: Java API Framework
Purpose: Provides Java classes and APIs that developers use to build Android applications

This component provides software tools and interfaces for building Android applications

| Manager/Component        | Function                                 |
| ------------------------ | ---------------------------------------- |
| **Activity Manager**     | Manages app lifecycle and activity stack |
| **Window Manager**       | Manages windows and screen display       |
| **Content Providers**    | Manages shared app data                  |
| **View System**          | UI components (buttons, lists, etc.)     |
| **Package Manager**      | Tracks installed applications            |
| **Telephony Manager**    | Phone call functionality                 |
| **Resource Manager**     | Access to non-code resources             |
| **Location Manager**     | GPS and location services                |
| **Notification Manager** | Display notifications                    |
**==Pentesters focus heavily on this layer.==**

```
// Example: Using Activity Manager ActivityManager am = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE); List<RunningAppProcessInfo> processes = am.getRunningAppProcesses();
```


### Layer 5: System Apps (Top Layer)
Top layer where user-installed apps run.

Apps include:
- System apps (Phone, Messages, Settings)
    
- User apps (WhatsApp, Instagram)

Each app runs in:
- its **own process**
    
- its own **Linux user ID**
    
- its own **sandbox**

```
Location: /system/app/ and /system/priv-app/
```

==Pre-installed apps can only be modified on rooted devices. However, developers can use them in their applications using the provided APIs. For example, a developer could create an app that uses the camera to scan a QR code.==

## Rooting

Android separates the flash storage into the following two main partitions.

- `/system/`
- `/data/`

The partition `/system/` is used by the operating system, and the partition `/data/` is used for user data and application installations. In Android, users don't have root access to the operating system, and some partitions (like `/system/`) are `read-only`. However, rooting the device can be achieved by exploiting security flaws. Having a rooted device enhances the capabilities and customizability of the device, and helps with debugging and overall security assessments. Rooted Android devices are also more susceptible to malicious viruses and malware, since the rooting process disables some of the built-in security features of the operating system. In some models like Google Pixel and OnePlus, rooting can also be achieved by unlocking the bootloader via the OEM Unlocking option.

## Important Directories

Android's file structure is very similar to other Linux distributions. The directories listed below are some of the most important to consider while conducting Android app assessments.

| **Directory**                     | **Description**                                                                                                                                |
| --------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| `/data/data`                      | Contains all the applications that are installed by the user                                                                                   |
| `/data/user/0`                    | Contains data that only the app can access                                                                                                     |
| `/data/app`                       | Contains the APKs of the applications that are installed by the user                                                                           |
| `/system/app`                     | Contains the pre-installed applications of the device                                                                                          |
| `/system/bin`                     | Contains binary files                                                                                                                          |
| `/data/local/tmp`                 | A world-writable directory                                                                                                                     |
| `/data/system`                    | Contains system configuration files                                                                                                            |
| `/etc/apns-conf.xml`              | Contains the default Access Point Name (APN) configurations. APN is used in order for the device to connect with our current carrier’s network |
| `/data/misc/wifi`                 | Contains WiFi configuration files                                                                                                              |
| `/data/misc/user/0/cacerts-added` | User certificate store. It contains certificates added by the user                                                                             |
| `/etc/security/cacerts/`          | System certificate store. Permission to non-root users is not permitted                                                                        |
| `/sdcard`                         | Contains a symbolic link to the directories DCIM, Downloads, Music, Pictures, etc.                                                             |