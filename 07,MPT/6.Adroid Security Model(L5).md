Android Security Model = Multiple layers of protection

![[mptnote.jpeg]]

Defense in Depth approach:
- â”œâ”€â”€ Hardware Level
- â”œâ”€â”€ Kernel Level
- â”œâ”€â”€ OS Level
- â”œâ”€â”€ Application Level
- â””â”€â”€ User Level



 1. **USER LEVEL**   
     1. (Permissions, Consent) 

2. **APPLICATION LEVEL**
     1. (Sandbox, Signing, Permissions, Components)  

 3. **OS LEVEL** 
      1. (SELinux, Seccomp, ASLR, Encryption)

 4. **KERNEL LEVEL**        
       1. (Linux Kernel, Process Isolation)  

5. **HARDWARE LEVEL**    
     1. (TEE, Secure Boot, Hardware Keystore) 



## 1. Application Sandbox (Core Security)

Sandbox = Isolated environment for each app

Each app:
1. â”œâ”€â”€ Gets unique Linux User ID (UID)
2. â”œâ”€â”€ Runs in separate process
3. â”œâ”€â”€ Has private data directory
4. â”œâ”€â”€ Cannot access other apps' data

#### How UIDs Work

**SYSTEM USERS:**-

root       = UID 0
system     = UID 1000
radio      = UID 1001
bluetooth  = UID 1002


**APP USERS:-**

First app  = UID 10000 (u0_a0)
Second app = UID 10001 (u0_a1)
Third app  = UID 10002 (u0_a2)

Each app = Unique Linux user


#### Data Directory Permissions

**App private directory**
/data/data/com.example.app/
    â”‚
    â”œâ”€â”€ Permissions: drwx------ (700)
    â”‚   â””â”€â”€ Only owner (app's UID) can access
    â”‚
    â”œâ”€â”€ shared_prefs/
    â”œâ”€â”€ databases/
    â”œâ”€â”€ files/
    â””â”€â”€ cache/

**Check permissions**
adb shell ls -la /data/data/

**Output**:
drwx------ u0_a100 u0_a100 com.app.one
drwx------ u0_a101 u0_a101 com.app.two
drwx------ u0_a102 u0_a102 com.app.three


#### Sandbox Exceptions

**WAYS TO SHARE DATA** 
1. SHARED USER ID (Same Developer)                         
    â””â”€â”€ android:sharedUserId="com.example.shared"           
    â””â”€â”€ Apps with same signature can share UID              
    â””â”€â”€ Can access each other's data  


2. CONTENT PROVIDERS                                       
    â””â”€â”€ Structured data sharing                             
    â””â”€â”€ With permission checks  

3. EXTERNAL STORAGE                                        
    â””â”€â”€ /sdcard/ - Any app can access                       
    â””â”€â”€ With STORAGE permission    


4. INTENTS                                                 
    â””â”€â”€ Message passing between apps 


 5. BOUND SERVICES                                          
    â””â”€â”€ IPC between apps  


###  BYPASS METHODS:  SANDBOX PENTESTING  

**BYPASS METHODS:**   
 1. Root access                                              
    1. â””â”€â”€ Full filesystem access  

 2. Debuggable app                                           
    1. â””â”€â”€ adb run-as com.example.app

3. Backup extraction                                        
    1. â””â”€â”€ If allowBackup="true"  

4. World-readable files                                     
    1. â””â”€â”€ Developer mistake 

5. Content Provider vulnerabilities                         
    1. â””â”€â”€ SQL injection, path traversal  

6. Shared UID                                               
    1. â””â”€â”€ Install malicious app with same sharedUserId         
    2. â””â”€â”€ (Requires same signing key)  


## 2. Permission Model

**Permission Architecture**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ANDROID PERMISSION MODEL                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    PERMISSION LEVELS                        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  NORMAL          â”€â”€â–º Auto-granted at install               â”‚ â”‚
â”‚  â”‚  (Low Risk)          No user interaction needed            â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  DANGEROUS       â”€â”€â–º User must explicitly grant            â”‚ â”‚
â”‚  â”‚  (Privacy/Data)      Runtime permission (API 23+)          â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  SIGNATURE       â”€â”€â–º Granted only if apps signed           â”‚ â”‚
â”‚  â”‚  (System)            with same certificate                 â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  SIGNATURE|      â”€â”€â–º Signature OR privileged app           â”‚ â”‚
â”‚  â”‚  PRIVILEGED          (in /system/priv-app/)                â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Runtime Permission Flow (API 23+)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                RUNTIME PERMISSION FLOW                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚    â”‚ App Requests     â”‚                                         â”‚
â”‚    â”‚ Permission       â”‚                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚             â”‚                                                    â”‚
â”‚             â–¼                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚    â”‚ Check if Already â”‚â”€â”€â”€â”€ YES â”€â”€â”€â”€â–º Permission Granted        â”‚
â”‚    â”‚ Granted?         â”‚                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚             â”‚ NO                                                 â”‚
â”‚             â–¼                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚    â”‚ Show Permission  â”‚                                         â”‚
â”‚    â”‚ Dialog to User   â”‚                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚             â”‚                                                    â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                             â”‚
â”‚       â–¼           â–¼                                             â”‚
â”‚    ALLOW       DENY                                              â”‚
â”‚       â”‚           â”‚                                             â”‚
â”‚       â–¼           â–¼                                             â”‚
â”‚   Permission   Permission                                        â”‚
â”‚   Granted      Denied                                            â”‚
â”‚                   â”‚                                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                        â”‚
â”‚              â–¼         â–¼                                        â”‚
â”‚         "Don't Ask   Can Ask                                    â”‚
â”‚          Again"      Again                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```



## 3. Application Signing

All apps must be digitally signed

Identifies the developer (not trust)

Prevents unauthorized updates

### APP SIGNING
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APP SIGNING EXPLAINED                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  REAL WORLD ANALOGY:                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚                                                             â”‚
â”‚  Think of it like a NOTARIZED DOCUMENT:                     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚                                         â”‚                â”‚
â”‚  â”‚  Document: "This is my app v1.0"       â”‚                â”‚
â”‚  â”‚                                         â”‚                â”‚
â”‚  â”‚  Signed by: John Developer              â”‚                â”‚
â”‚  â”‚  Signature: [Unique cryptographic mark] â”‚                â”‚
â”‚  â”‚                                         â”‚                â”‚
â”‚  â”‚  âœ“ Proves John wrote this               â”‚                â”‚
â”‚  â”‚  âœ“ Proves document not modified         â”‚                â”‚
â”‚  â”‚  âœ“ Only John can write updates          â”‚                â”‚
â”‚  â”‚                                         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â”‚  WHAT SIGNING GUARANTEES:                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚                                                             â”‚
â”‚  1. INTEGRITY                                               â”‚
â”‚     â””â”€â”€ APK has not been modified after signing             â”‚
â”‚     â””â”€â”€ Any tampering breaks the signature                  â”‚
â”‚                                                             â”‚
â”‚  2. AUTHENTICITY                                            â”‚
â”‚     â””â”€â”€ Proves who created the app                          â”‚
â”‚     â””â”€â”€ Developer's identity is verifiable                  â”‚
â”‚                                                             â”‚
â”‚  3. UPDATE AUTHORIZATION                                    â”‚
â”‚     â””â”€â”€ Only apps signed with SAME key can update          â”‚
â”‚     â””â”€â”€ Prevents malicious updates                          â”‚
â”‚                                                             â”‚
â”‚  4. TRUST ESTABLISHMENT                                     â”‚
â”‚     â””â”€â”€ Same signature = Same developer = Shared trust     â”‚
â”‚     â””â”€â”€ Enables signature-level permissions                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


## 4. SELinux (Security-Enhanced Linux)

SELinux provides Mandatory Access Control (MAC) - an extra security layer on top of traditional Linux permissions.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚   NORMAL SECURITY (Without SELinux)                        â”‚
â”‚   "You have the key? OK, come in!"                         â”‚
â”‚                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚   WITH SELINUX                                             â”‚
â”‚   "You have key, but let me check                          â”‚
â”‚    the rulebook if you're allowed..."                      â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### DAC vs MAC

| Type                               | Description<br>                                                                                        |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------ |
| DAC (Discretionary Access Control) | Traditional Linux permissions. Owner controls access. If compromised, attacker has user's permissions. |
| MAC (Mandatory Access Control)     | System-enforced policies. Even root restricted by policy. Defense in depth.                            |

#### SELinux Modes

Mode	Description

| Mode         | Description<br>                                                                                  |
| ------------ | ------------------------------------------------------------------------------------------------ |
| `Disabled`   | SELinux completely off. No MAC enforcement. NOT allowed on Android 5.0+                          |
| `Permissive` | Logs violations but doesn't block. Used for policy development. All access allowed, only logged. |
| `Enforcing`  | Actively enforces policies. Blocks unauthorized access. Logs violations. Required on Android.    |
**Check SELinux Status**
```
adb shell getenforce
# Output: Enforcing | Permissive | Disabled
```

#### SELinux Context Labels
Context Format
user:role:type:level

Example: u:r:untrusted_app:s0:c512,c768

**Component**	                            **Description**
u	                                                   User
r	                                                   Role
untrusted_app	                               Type (most important)
s0:c512,c768	                                MLS/MCS Level



## 5. Secure Boot Chain

#### Boot Process Overview
When the phone turns ON, it verifies each component step by step before loading the next.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 1: PRIMARY BOOTLOADER (PBL)                       â”‚
â”‚  â”œâ”€â”€ Burned into ROM (hardware)                          â”‚
â”‚  â”œâ”€â”€ Cannot be modified                                  â”‚
â”‚  â”œâ”€â”€ Contains Root of Trust (public key)                 â”‚
â”‚  â””â”€â”€ Verifies Secondary Bootloader                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 2: SECONDARY BOOTLOADER (SBL/XBL)                 â”‚
â”‚  â”œâ”€â”€ Stored in boot partition                            â”‚
â”‚  â”œâ”€â”€ Initializes hardware                                â”‚
â”‚  â”œâ”€â”€ Loads and verifies Aboot/ABL                       â”‚
â”‚  â””â”€â”€ May implement Fastboot                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 3: ANDROID BOOTLOADER (Aboot/ABL)                 â”‚
â”‚  â”œâ”€â”€ Implements Fastboot mode                            â”‚
â”‚  â”œâ”€â”€ Verifies boot/recovery partition                    â”‚
â”‚  â”œâ”€â”€ Checks device lock status                           â”‚
â”‚  â””â”€â”€ Implements Android Verified Boot (AVB)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 4: KERNEL + RAMDISK                               â”‚
â”‚  â”œâ”€â”€ Linux kernel loads                                  â”‚
â”‚  â”œâ”€â”€ Initial ramdisk mounted                             â”‚
â”‚  â”œâ”€â”€ dm-verity verifies system partition                 â”‚
â”‚  â””â”€â”€ Init process starts                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 5: ANDROID SYSTEM                                 â”‚
â”‚  â”œâ”€â”€ Init process executes                               â”‚
â”‚  â”œâ”€â”€ Zygote starts                                       â”‚
â”‚  â”œâ”€â”€ System Server starts                                â”‚
â”‚  â””â”€â”€ Android framework boots                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Android Verified Boot (AVB)
AVB Versions

    Verified Boot 1.0 - Android 4.4+
    Verified Boot 2.0 (AVB) - Android 8.0+


#### Boot States

| State               | Color     | Description                                                                                   |
| ------------------- | --------- | --------------------------------------------------------------------------------------------- |
| VERIFIED            | ğŸŸ¢ Green  | Fully verified boot chain. All signatures valid. Bootloader locked. OEM certificate used.     |
| SELF-SIGNED         | ğŸŸ¡ Yellow | Custom key verification. Bootloader locked. User-added certificate. Warning shown at boot.    |
| UNLOCKED            | ğŸŸ  Orange | Bootloader unlocked. Verification may be skipped. Warning shown at boot. Custom ROMs allowed. |
| VERIFICATION FAILED | ğŸ”´ Red    | Corrupted boot chain. May refuse to boot. Or boot with severe warnings. Data may be wiped.    |

## 6. Hardware-Backed Security
### Hardware Security Components
#### TEE (Trusted Execution Environment)
##### 1.TEE Overview

    Isolated secure environment
    Runs parallel to Android OS
    ARM TrustZone based
    Handles sensitive operations

##### 2.Secure Element (SE)
Secure Element

    Tamper-resistant hardware chip
    Stores keys and credentials
    Used for payments (NFC)
    eSE (embedded) or UICC-based

##### StrongBox (Android 9+)
StrongBox

    Discrete tamper-resistant hardware
    Separate CPU, memory, storage
    Highest security key storage
    Resistant to side-channel attacks

### Android Keystore System
```
APPLICATION
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        KEYSTORE API (Java)              â”‚
â”‚   (KeyStore, KeyGenerator, Cipher)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         KEYSTORE SERVICE               â”‚
â”‚    (keystore2 daemon - Android 12+)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEE-backed  â”‚          â”‚  StrongBox   â”‚
â”‚  Keymaster   â”‚          â”‚  Keymaster   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Properties**

| Property                                          | Description                   |
| ------------------------------------------------- | ----------------------------- |
| `setUserAuthenticationRequired(true)`             | Requires user auth to use key |
| `setUserAuthenticationValidityDurationSeconds(n)` | Auth validity duration        |
| `setIsStrongBoxBacked(true)`                      | Store in StrongBox            |
| `setUnlockedDeviceRequired(true)`                 | Only use when device unlocked |
| `setKeyValidityEnd(date)`                         | Key expiration date           |


## 7. Data Storage Security
#### Storage Locations
**1.Internal Storage (Private)**
Internal Storage

    Location: /data/data/<package>/
    Sandboxed per application
    Only accessible by owning app
    Deleted when app uninstalled
    Encrypted with FBE

**2.External Storage (Shared)**
External Storage

    Location: /sdcard/, /storage/emulated/0/
    Shared between all apps
    Requires STORAGE permissions
    Scoped Storage (Android 10+)
    May or may not be encrypted

#### Content Providers
Content Providers

    Structured data sharing
    SQLite databases exposed via URI
    Can be protected by permissions
    Potential for SQL injection

## 8. Network Security
#### Network Security Configuration
Network Security Config

    Introduced: Android 7.0+ (API 24)
    Location: res/xml/network_security_config.xml

**Configuration Options**

    Trust anchors (Custom CA certificates)
    Certificate pinning
    Cleartext traffic control
    Debug-only overrides
