A race condition occurs when:

- Multiple operations happen at the same time
- They access the same resource/data
- The outcome depends on WHO FINISHES FIRST
- Attacker manipulates timing for unintended results


#### Bank Account Example

You have: $100 in account

**Race condition exploit:**-

```
Request 1: Check balance ($100) â”€â”€â”
Request 2: Check balance ($100) â”€â”€â”¼â”€â”€ Both see $100!
Request 1: Withdraw $100 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
Request 2: Withdraw $100 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Result: You withdrew $200 from a $100 account! ðŸ’°


### How Race Conditions Work

REQUEST 1                DATABASE               REQUEST 2

Check balance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Check balance
â—„â”€â”€ Returns $100 â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€ Returns $100 â”€â”€â–º

Both see $100!                              Both see $100!

**Withdraw $100 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Withdraw $100**
**â—„â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Success â”€â”€â”€â”€â–º**

Result: $200 withdrawn from $100 account!


## Types of Race Conditions

1. LIMIT OVERRUN

    Use discount code multiple times
    Redeem reward points multiple times
    Vote multiple times

2. TOCTOU (Time-of-Check to Time-of-Use)

    Check permission, then perform action
    Gap between check and action is exploitable

3. DOUBLE SPENDING

    Spend same money/credits twice
    Common in payment systems

4. CONCURRENT FILE ACCESS

    Multiple processes writing to same file
    Can cause data corruption

5. SESSION RACING

    Manipulate session data during processing


## Real-World Impact

FINANCIAL

- Apply discount code multiple times
- Transfer money multiple times
- Redeem gift cards multiple times
- Withdraw more than balance allows

 AUTHENTICATION

- Bypass rate limiting on login
- Brute force OTP codes
- Bypass account lockout

 INVENTORY

- Buy more items than in stock
- Claim limited rewards multiple times

 PRIVILEGE ESCALATION

- Gain admin access during role change
- Bypass permission checks

## Prevention Methods

#### 1. DATABASE LOCKS

- Lock row/table during transaction
- SELECT ... FOR UPDATE

#### 2. ATOMIC OPERATIONS

Single database query for check AND update

```SQL
UPDATE balance SET amount = amount - 100 
WHERE user_id = 1 AND amount >= 100
```

#### 3. MUTEX/SEMAPHORES

- Application-level locking
- Only one thread can access resource

#### 4. IDEMPOTENCY KEYS

- Unique key for each transaction
- Reject duplicate keys

#### 5. OPTIMISTIC LOCKING

- Version numbers on records
- Reject if version changed during operation


## Lab 1:-  Limit overrun race conditions

**Goal: Buy a leather jacket by applying the discount code more than once**
**Key Concept: Sending multiple requests simultaneously to bypass single-use restriction**


**login and add jacket to cart and then apply coupon**

**Capture the Coupon Request**

- Open Burp Suite
- Turn Intercept ON
- Enter PROMO20 and click Apply
- Capture the request

#### Prepare the Race Condition Attack

Send the request to Repeater

Now we need to send this request many times simultaneously.

**Using Repeater Tab Groups (Easiest)**

- In Repeater, right-click the tab
- Select "Duplicate tab"
- Repeat this 20-25 times (you need many tabs)
- Select all tabs (Ctrl+click each tab)
- Right-click â†’ "Add tabs to group" â†’ "New group"
- Name it "Race Attack"

#### Execute the Attack


Make sure all tabs are in the group
Click on the group dropdown arrow

Select "Send group in parallel (single-packet attack)"
All requests fire simultaneously!


## Lab 2:-  Bypassing rate limits via race conditions

**Goal: Brute force carlos's password and access his account**
**Key Concept: Send multiple login attempts simultaneously before rate limit kicks in**


