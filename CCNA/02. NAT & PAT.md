# **Network Address Translation (NAT)** 

- NAT is a method of translating private IP addresses to public IP addresses (and vice versa) to allow internal devices to communicate with the internet.
- It’s a process that happens in a router or firewall to translate private IP addresses → public IP address (and back).


==NAT hides internal IPs from outside view, which is why recon and pivoting often focus on discovering what’s behind the NAT (internal subnets).==


```
┌──────────────────────────────────────────────────────────────────┐
│                                                                  │
│   PRIVATE NETWORK              NAT              INTERNET         │
│                               ROUTER                             │
│   ┌─────────┐                                                    │
│   │   PC1   │                ┌──────┐         ┌──────────┐       │
│   │192.168.1.10├────────────►│      │         │          │       │
│   └─────────┘                │      │         │  Google  │       │
│   ┌─────────┐                │ NAT  ├────────►│  8.8.8.8 │       │
│   │   PC2   │                │      │203.0.113.5         │       │
│   │192.168.1.11├────────────►│      │         │          │       │
│   └─────────┘                └──────┘         └──────────┘       │
│                                                                  │
│   Private IPs              Translates        Public Internet     │
│   (Not Routable)           Addresses         (Routable)          │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

## Need of NAT?
```
┌─────────────────────────────────────────────┐
│  Total IPv4 Addresses: ~4.3 Billion         │
│  World Population: ~8 Billion               │
│  Connected Devices: ~30+ Billion            │
│                                             │
│  ❌ NOT ENOUGH PUBLIC IPs FOR EVERYONE!     │
└─────────────────────────────────────────────┘
```

### Solution: Private IP Addresses + NAT
```
Private IP Ranges (RFC 1918):
┌────────────────────────────────────────────┐
│  Class A: 10.0.0.0 - 10.255.255.255        │
│           (16 million+ addresses/HOSTS)    │
│                                            │
│  Class B: 172.16.0.0 - 172.31.255.255      │
│           (1 million+ addresses/HOSTS)     │
│                                            │
│  Class C: 192.168.0.0 - 192.168.255.255    │
│           (65,000+ addresses/HOSTS)        │
└────────────────────────────────────────────┘

These addresses are FREE and REUSABLE!
But they are NOT routable on the internet.
```

## Outbound Traffic (Inside → Outside)
```
STEP 1: PC sends packet
┌─────────────────────────────────────┐
│  Source IP: 192.168.1.10            │
│  Destination IP: 8.8.8.8            │
│  Data: "DNS Query"                  │
└─────────────────────────────────────┘
              │
              ▼
STEP 2: NAT Router translates source IP
┌─────────────────────────────────────┐
│  Source IP: 203.0.113.5  ◄── Changed│
│  Destination IP: 8.8.8.8            │
│  Data: "DNS Query"                  │
└─────────────────────────────────────┘
              │
              ▼
STEP 3: Router stores translation in NAT table
┌─────────────────────────────────────┐
│  Inside Local    │  Inside Global   │
│  192.168.1.10    │  203.0.113.5     │
└─────────────────────────────────────┘
              │
              ▼
STEP 4: Packet sent to internet with public IP
```

## Inbound Traffic (Outside → Inside)
```
STEP 1: Reply comes from internet
┌─────────────────────────────────────┐
│  Source IP: 8.8.8.8                 │
│  Destination IP: 203.0.113.5        │
│  Data: "DNS Reply"                  │
└─────────────────────────────────────┘
              │
              ▼
STEP 2: Router checks NAT table
┌─────────────────────────────────────┐
│  203.0.113.5 → 192.168.1.10         │
└─────────────────────────────────────┘
              │
              ▼
STEP 3: Router translates destination IP
┌─────────────────────────────────────┐
│  Source IP: 8.8.8.8                 │
│  Destination IP: 192.168.1.10 ◄── Changed
│  Data: "DNS Reply"                  │
└─────────────────────────────────────┘
              │
              ▼
STEP 4: Packet delivered to internal PC
```

## Types of NAT
### Static NAT
**One-to-One permanent mapping**
```
┌─────────────────────────────────────────────────────┐
│                                                     │
│   192.168.1.10  ◄────────────►  203.0.113.10       │
│   192.168.1.11  ◄────────────►  203.0.113.11       │
│   192.168.1.12  ◄────────────►  203.0.113.12       │
│                                                     │
│   Permanent 1:1 mapping - Never changes!            │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**When to Use:**
- Web servers
- Email servers
- Any device that needs to be accessed from internet

### Dynamic NAT
**One-to-One mapping from a pool (temporary)**
```
┌─────────────────────────────────────────────────────┐
│                                                     │
│   Pool: 203.0.113.10 - 203.0.113.15                │
│   (6 public IPs available)                         │
│                                                     │
│   192.168.1.10 ────► Gets 203.0.113.10 (temp)      │
│   192.168.1.11 ────► Gets 203.0.113.11 (temp)      │
│   192.168.1.12 ────► Gets 203.0.113.12 (temp)      │
│   192.168.1.13 ────► Waiting... (no IPs free)      │
│                                                     │
│   First come, first served!                        │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**Problem:** Limited by pool size

#### Pool
A pool is a reserved group of public IP addresses that the router can hand out temporarily to internal devices.

**Pool = Limited resource**
If you have 6 IPs in pool, only 6 devices can access internet simultaneously

**example:**
```
! Step 1: Define the pool
ip nat pool MY_POOL 203.0.113.10 203.0.113.15 netmask 255.255.255.0

! This creates:
! 203.0.113.10
! 203.0.113.11
! 203.0.113.12
! 203.0.113.13
! 203.0.113.14
! 203.0.113.15
! = 6 usable public IPs
```

# Port Address Translation (PAT)

Also called NAT Overload or NAPT

- PAT allows MANY private IPs to share ONE public IP by using different PORT NUMBERS to distinguish connections.
- PAT is a specialized type of Network Address Translation, most commonly referred to as NAT Overload. It is the most widely used form of NAT in the world, because it solves IPv4 address exhaustion more efficiently than any other NAT type.

```
┌─────────────────────────────────────────────────────────────┐
│                         PAT                                 │
│              (Many-to-One Translation)                      │
│                                                             │
│   INSIDE                              OUTSIDE               │
│                                                             │
│   192.168.1.10:50001 ──┐                                    │
│                        ├──► 203.0.113.5:50001 ──► Internet  │
│   192.168.1.11:50002 ──┤                                    │
│                        ├──► 203.0.113.5:50002 ──► Internet  │
│   192.168.1.12:50003 ──┤                                    │
│                        ├──► 203.0.113.5:50003 ──► Internet  │
│   192.168.1.13:50004 ──┘                                    │
│                        ▲                                    │
│                        │                                    │
│              ALL share ONE public IP                        │
│              (differentiated by PORT)                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```
## Need of PAT
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│   THE PROBLEM:                                                                  │
│   ─────────────                                                                 │
│                                                                                 │
│   • IPv4 has only ~4.3 billion addresses                                        │
│   • World has 8+ billion people                                                 │
│   • Each person has multiple devices                                            │
│   • Public IPs are EXPENSIVE and LIMITED                                        │
│                                                                                 │
│   ─────────────────────────────────────────────────────────────────────         │
│                                                                                 │
│   THE SOLUTION: PAT                                                             │
│   ───────────────────                                                           │
│                                                                                 │
│   • Your home has 10 devices                                                    │
│   • ISP gives you only 1 public IP                                              │
│   • PAT lets all 10 devices share that 1 IP!                                    │
│   • Uses PORT NUMBERS to track each device's connection                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Working of PAT

```
┌──────────────────────────────────────────────────────────────┐
│                    PAT Translation Table                     │
├──────────────────────┬───────────────────────────────────────┤
│   Inside Local       │   Inside Global                       │
├──────────────────────┼───────────────────────────────────────┤
│   192.168.1.10:51772 │   203.0.113.5:51772                   │
│   192.168.1.11:52880 │   203.0.113.5:52880                   │
│   192.168.1.12:49320 │   203.0.113.5:49320                   │
│   192.168.1.13:61445 │   203.0.113.5:61445                   │
└──────────────────────┴───────────────────────────────────────┘

Router tracks: "Port 51772 belongs to 192.168.1.10"
```

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│                         PAT SIMPLE CONCEPT                                      │
│                                                                                 │
│   INSIDE (Private)              ROUTER                OUTSIDE (Internet)        │
│                                with PAT                                         │
│                                                                                 │
│   Device 1: 192.168.1.10 ──┐                                                    │
│   Device 2: 192.168.1.11 ──┼──► ONE Public IP ──► Internet                      │
│   Device 3: 192.168.1.12 ──┤    203.0.113.5                                     │
│   Device 4: 192.168.1.13 ──┘                                                    │
│                                                                                 │
│   How does router know which response goes to which device?                     │
│                                                                                 │
│   ANSWER: PORT NUMBERS!                                                         │
│                                                                                 │
│   Device 1 uses: 203.0.113.5:50001                                              │
│   Device 2 uses: 203.0.113.5:50002                                              │
│   Device 3 uses: 203.0.113.5:50003                                              │
│   Device 4 uses: 203.0.113.5:50004                                              │
│                                                                                 │
│   Same IP, different PORTS!                                                     │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```
