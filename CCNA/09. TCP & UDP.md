## Segment 
```
+----------------------------------------------------------+
|                    WHAT IS SEGMENT?                       |
+----------------------------------------------------------+
|                                                          |
|   SEGMENT = Layer 4 PDU (Protocol Data Unit)             |
|                                                          |
|   SEGMENT = HEADER + DATA                                |
|                                                          |
|   ┌─────────────────────────────────────────────────┐    |
|   │    HEADER     │           DATA                  │    |
|   │  (Control     │      (Actual payload            │    |
|   │   information)│       from upper layers)        │    |
|   └─────────────────────────────────────────────────┘    |
|                                                          |
|   TCP Segment = TCP Header + Data                        |
|   UDP Datagram = UDP Header + Data                       |
|                                                          |
+----------------------------------------------------------+
```


![[Screenshot (95).png]]
## TCP SEGMENT FORMAT
```
+----------------------------------------------------------+
|                   TCP HEADER SIZE                         |
+----------------------------------------------------------+
|                                                          |
|   Minimum Size: 20 bytes (without options)               |
|   Maximum Size: 60 bytes (with options)                  |
|                                                          |
|   Total: 10 Fields                                       |
|                                                          |
+----------------------------------------------------------+
```

###   TCP SEGMENT FORMAT  

**A 1460 MSS Packet Have all this Data.**
```
+----------------------------------------------------------+
|                    TCP HEADER FORMAT                      |
+----------------------------------------------------------+

   ←─────────────────── 32 bits (4 bytes) ──────────────────→

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |          SOURCE PORT          |       DESTINATION PORT        |  ← 4 bytes
  |           (16 bits)           |           (16 bits)           |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  |                      SEQUENCE NUMBER                          |  ← 4 bytes
  |                          (32 bits)                            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  |                   ACKNOWLEDGMENT NUMBER                       |  ← 4 bytes
  |                          (32 bits)                            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  | Data  |       |U|A|P|R|S|F|                                   |
  |Offset |Reserved|R|C|S|S|Y|I|            WINDOW SIZE           |  ← 4 bytes
  |(4 bits)|(6 bits)|G|K|H|T|N|N|           (16 bits)             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           CHECKSUM            |         URGENT POINTER        |  ← 4 bytes
  |           (16 bits)           |           (16 bits)           |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  |                    OPTIONS (if any)                           |  ← 0-40 bytes
  |                       (Variable)                              |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  |                           DATA                                |  ← Variable
  |                       (Payload)                               |
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    TOTAL HEADER: 20-60 bytes
```

```
+--------+------------------+--------+------------------------------------------------+----------------------------------+
| S.No   | Field Name       | Size   | Purpose / Description                          | Example                          |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   1    | Source Port      | 16 bits| Identifies sending application                 | 52431 (browser random port)      |
|        |                  | (2 B)  | Range: 0-65535                                 |                                  |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   2    | Destination Port | 16 bits| Identifies receiving application               | 443 (HTTPS), 80 (HTTP)           |
|        |                  | (2 B)  | Range: 0-65535                                 | 22 (SSH), 21 (FTP)               |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   3    | Sequence Number  | 32 bits| Numbers each byte of data sent                 | Seq=1000 means "starting         |
|        |                  | (4 B)  | Used for ordering & reassembly                 | from byte 1000"                  |
|        |                  |        | Detects missing/duplicate segments             | Next: Seq=1500 (if 500B sent)    |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   4    | Acknowledgment   | 32 bits| Next byte number expected by receiver          | ACK=1500 means "I got all        |
|        | Number           | (4 B)  | Confirms receipt of data                       | bytes up to 1499, send 1500"     |
|        |                  |        | Valid only when ACK flag = 1                   |                                  |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   5    | Data Offset      | 4 bits | Tells header length (where data starts)        | Value 5 = 5×4 = 20 bytes         |
|        | (Header Length)  |        | Value = number of 32-bit words                 | Value 15 = 15×4 = 60 bytes       |
|        |                  |        | Min: 5 (20B), Max: 15 (60B)                    |                                  |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   6    | Reserved         | 6 bits | Reserved for future use                        | Always set to 000000             |
|        |                  |        | Must be zero                                   |                                  |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   7    | Control Flags    | 6 bits | Controls connection state                      |                                  |
|        |                  | (1 bit | URG: Urgent data present                       | Ctrl+C sends URG                 |
|        |                  | each)  | ACK: Acknowledgment valid                      | Almost all segments have ACK=1   |
|        |                  |        | PSH: Push data immediately                     | Chat messages use PSH            |
|        |                  |        | RST: Reset/abort connection                    | Connection error                 |
|        |                  |        | SYN: Start new connection                      | 3-way handshake start            |
|        |                  |        | FIN: Finish/close connection                   | Connection termination           |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   8    | Window Size      | 16 bits| Flow control - receiver's buffer space         | Window=16384 means "I can        |
|        |                  | (2 B)  | How much data receiver can accept              | receive 16384 bytes"             |
|        |                  |        | Prevents sender from overwhelming receiver     | Window=0 means "STOP sending"    |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   9    | Checksum         | 16 bits| Error detection for header + data              | Sender calculates & adds         |
|        |                  | (2 B)  | Mandatory in TCP                               | Receiver recalculates & compares |
|        |                  |        | If mismatch, segment is corrupted              | Mismatch = discard segment       |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|  10    | Urgent Pointer   | 16 bits| Points to end of urgent data                   | URG=1, Pointer=5 means           |
|        |                  | (2 B)  | Valid only when URG flag = 1                   | "First 5 bytes are urgent"       |
|        |                  |        | Urgent data processed immediately              |                                  |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|  11    | Options          | 0-40   | Additional features (optional)                 | MSS: Max Segment Size (1460)     |
|        |                  | bytes  | Variable length                                | Window Scale: Larger windows     |
|        |                  |        | Padded to 32-bit boundary                      | Timestamp: RTT measurement       |
|        |                  |        |                                                | SACK: Selective acknowledgment   |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|  12    | Data (Payload)   |Variable| Actual application data                        | HTTP request, file content       |
|        |                  |        | From upper layers                              | Email message, web page          |
+--------+------------------+--------+------------------------------------------------+----------------------------------+

TOTAL HEADER SIZE: 20 bytes (minimum) to 60 bytes (maximum)
```

### Control Flag/Code Bit

#### TCP Control Flags (Code Bits)

| Bit |  Flag   | Full Name      | Size  | Purpose / Description                                                                                                                | When Used                                                                 | Example                                           |
| :-: | :-----: | :------------- | :---: | :----------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------ | :------------------------------------------------ |
|  1  | **URG** | Urgent         | 1 bit | Indicates urgent data is present. Urgent Pointer field becomes valid. Data should be processed immediately, bypassing normal buffer. | When priority data needs immediate attention                              | Ctrl+C to interrupt/abort a file transfer         |
|  2  | **ACK** | Acknowledgment | 1 bit | Indicates Acknowledgment Number field is valid. Confirms receipt of data.                                                            | Set in almost ALL segments after initial SYN. Used throughout connection. | Confirming "I received your data"                 |
|  3  | **PSH** | Push           | 1 bit | Push data to application immediately. Don't wait for buffer to fill. Receiver should deliver data to app right away.                 | Real-time applications, interactive sessions                              | Chat messages, SSH keystrokes, Telnet             |
|  4  | **RST** | Reset          | 1 bit | Reset/abort connection immediately. Something went wrong. No graceful termination.                                                   | Connection error, refused connection, invalid segment received            | Connection attempt to closed port, crash recovery |
|  5  | **SYN** | Synchronize    | 1 bit | Initiate new connection. Synchronize sequence numbers between sender and receiver.                                                   | First two steps of 3-way handshake (SYN, SYN-ACK)                         | Client initiating connection to server            |
|  6  | **FIN** | Finish         | 1 bit | Sender has no more data to send. Request to close connection gracefully.                                                             | Connection termination (4-way handshake)                                  | Gracefully closing a connection                   |

 **Total Flags:** 6 bits (1 bit each)
  **Location:** TCP Header, after Reserved field
## UDP DATAGRAM FORMAT
```
+----------------------------------------------------------+
|                   UDP HEADER SIZE                         |
+----------------------------------------------------------+
|                                                          |
|   Fixed Size: 8 bytes ONLY!                              |
|                                                          |
|   Total: 4 Fields                                        |
|                                                          |
|   VERY SIMPLE compared to TCP (20-60 bytes)              |
|                                                          |
+----------------------------------------------------------+
```

#### UDP Header Structure
```
+----------------------------------------------------------+
|                    UDP HEADER FORMAT                      |
+----------------------------------------------------------+

   ←─────────────────── 32 bits (4 bytes) ──────────────────→

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |          SOURCE PORT          |       DESTINATION PORT        |  ← 4 bytes
  |           (16 bits)           |           (16 bits)           |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            LENGTH             |           CHECKSUM            |  ← 4 bytes
  |           (16 bits)           |           (16 bits)           |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  |                           DATA                                |  ← Variable
  |                       (Payload)                               |
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    TOTAL HEADER: 8 bytes ONLY!
```

```
+--------+------------------+--------+------------------------------------------------+----------------------------------+
| S.No   | Field Name       | Size   | Purpose / Description                          | Example                          |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   1    | Source Port      | 16 bits| Identifies sending application                 | 54321 (client random port)       |
|        |                  | (2 B)  | Range: 0-65535                                 | 68 (DHCP client)                 |
|        |                  |        | OPTIONAL in UDP (can be 0 if no reply needed)  | 0 (if no reply expected)         |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   2    | Destination Port | 16 bits| Identifies receiving application               | 53 (DNS)                         |
|        |                  | (2 B)  | Range: 0-65535                                 | 67 (DHCP server)                 |
|        |                  |        | Tells which app should receive the data        | 69 (TFTP)                        |
|        |                  |        |                                                | 161 (SNMP)                       |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   3    | Length           | 16 bits| Total size of UDP datagram                     | Minimum: 8 (header only)         |
|        |                  | (2 B)  | Includes header (8 bytes) + data               | Example: 108 = 8 header + 100 data|
|        |                  |        | Minimum: 8 bytes (no data)                     | Maximum: 65535 bytes             |
|        |                  |        | Maximum: 65535 bytes                           |                                  |
|        |                  |        | Formula: Length = 8 + Data Size                |                                  |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   4    | Checksum         | 16 bits| Error detection for header + data              | Sender calculates & adds         |
|        |                  | (2 B)  | Verifies data integrity                        | Receiver recalculates & compares |
|        |                  |        | IPv4: OPTIONAL (can be 0)                      | 0 = checksum not calculated      |
|        |                  |        | IPv6: MANDATORY (must calculate)               | Mismatch = discard silently      |
|        |                  |        | If error found, datagram discarded (no retry)  | No retransmission in UDP         |
+--------+------------------+--------+------------------------------------------------+----------------------------------+
|   5    | Data (Payload)   |Variable| Actual application data                        | DNS query                        |
|        |                  |        | From upper layers (Layer 5, 6, 7)              | DHCP request                     |
|        |                  |        | Maximum: 65527 bytes (65535 - 8 header)        | Video/audio stream               |
|        |                  |        | No segmentation by UDP (app must handle)       | Game data                        |
+--------+------------------+--------+------------------------------------------------+----------------------------------+

TOTAL HEADER SIZE: 8 bytes (FIXED - always same)
TOTAL FIELDS: 4 only (very simple)
```

### Checksum
```
+----------------------------------------------------------+
|                  WHY CHECKSUM NEEDED?                     |
+----------------------------------------------------------+
|                                                          |
|   PROBLEM: Data can get corrupted during transmission    |
|                                                          |
|   CAUSES OF CORRUPTION:                                  |
|   ┌─────────────────────────────────────────────────┐    |
|   │  • Electrical interference                      │    |
|   │  • Signal noise                                 │    |
|   │  • Hardware failures                            │    |
|   │  • Cosmic rays (yes, really!)                   │    |
|   │  • Loose cables                                 │    |
|   │  • Wireless interference                        │    |
|   └─────────────────────────────────────────────────┘    |
|                                                          |
|   SOLUTION: Checksum detects if corruption happened      |
|                                                          |
+----------------------------------------------------------+
```